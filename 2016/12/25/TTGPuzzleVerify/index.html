<!DOCTYPE HTML>
<html>
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="chrome=1">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">

    

    <title>开源项目-拼图验证控件TTGPuzzleVerify的实现 | iOS，Android程序猿，喜欢Mac、Linux、各种开源技术，各种语言</title>
    <meta name="author" content="燕泽堃">
    
    <meta name="description" content="程序猿">
    
    
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">

    <meta property="og:title" content="开源项目-拼图验证控件TTGPuzzleVerify的实现"/>
    <meta property="og:site_name" content="土土哥的技术Blog"/>

    
    <meta property="og:image" content="undefined"/>
    

    <link rel="icon" type="image/png" href="/favicon.png">
    <link rel="alternate" href="/atom.xml" title="土土哥的技术Blog" type="application/atom+xml">
    <link rel="stylesheet" href="/css/lib/materialize.min.css">
    <link rel="stylesheet" href="/css/lib/font-awesome.min.css">
    <link rel="stylesheet" href="/css/style.css" media="screen" type="text/css">

    
        <link rel="stylesheet" href="/css/lib/prettify-tomorrow-night-eighties.css" type="text/css">
    
    <!--[if lt IE 9]><script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script><![endif]-->
</head>


<body>
    <img src="/weixin_favicon.png" style="position: absolute; left: -9999px; opacity: 0; filter: alpha(opacity=0);">

    <nav class="blue-grey">
    <div class="nav-wrapper">
        <a href="#" data-activates="main-menu" class="button-collapse">
            <i class="fa fa-navicon"></i>
        </a>
        <div class="">
            <a href="/" class="brand-logo hide-on-med-and-down">土土哥的技术Blog</a>
            <ul class="right hide-on-med-and-down">
                
                    <li>
                        <a class="menu-home " href="/" >
                            <i class="fa fa-home "></i>
                            
                            首页
                        </a>
                    </li>
                
                    <li>
                        <a class="menu-archive " href="/archives" >
                            <i class="fa fa-archive "></i>
                            
                            归档
                        </a>
                    </li>
                
                    <li>
                        <a class="menu-category category-menu" href="javascript:;" data-activates="category-menu" >
                            <i class="fa fa-bookmark "></i>
                            
                            分类
                        </a>
                    </li>
                
                    <li>
                        <a class="menu-about " href="/about" >
                            <i class="fa fa-user "></i>
                            
                            关于
                        </a>
                    </li>
                
                    <li>
                        <a class="menu-search modal-trigger " href="#search" >
                            <i class="fa fa-search "></i>
                            
                            搜索
                        </a>
                    </li>
                
            </ul>
            <div>
    <ul class="side-nav blue-grey darken-1" id="main-menu">
        
        <li class="side-user">
            <div class="row">
                <div class="col s4 no-padding">
                    <img class="avatar-image circle responsive-img" src="http://7nj2iz.com1.z0.glb.clouddn.com/avatar_comic_big.png" alt="User Avatar">
                </div>
                <div class="info col s8 valign-wrapper no-padding">
                    <div class="valign">
                        <p class="name">土土哥</p>
                        <p class="desc">iOS/Android/技术宅</p>
                    </div>
                </div>
            </div>
        </li>
        

        
            <li class="no-padding">
                <a class="waves-effect menu-home " href="/" >
                    <i class="fa fa-home "></i>
                    
                    首页
                </a>
            </li>
        
            <li class="no-padding">
                <a class="waves-effect menu-archive " href="/archives" >
                    <i class="fa fa-archive "></i>
                    
                    归档
                </a>
            </li>
        
            <li class="no-padding">
                <a class="waves-effect menu-category category-menu" href="javascript:;" data-activates="category-menu" >
                    <i class="fa fa-bookmark "></i>
                    
                    分类
                </a>
            </li>
        
            <li class="no-padding">
                <a class="waves-effect menu-about " href="/about" >
                    <i class="fa fa-user "></i>
                    
                    关于
                </a>
            </li>
        
            <li class="no-padding">
                <a class="waves-effect menu-search modal-trigger " href="#search" >
                    <i class="fa fa-search "></i>
                    
                    搜索
                </a>
            </li>
        
    </ul>

    <ul class="side-nav blue-grey darken-1" id="category-menu">
    

            

            <li class="collapse-level-0" collapse-level="0">
                <a class="no-padding" href="/categories/iOS/">
                    iOS <span class="right">37 篇</span></a>
                </a>
            </li>

        

            <li class="collapse-level-0" collapse-level="0">
                <a class="no-padding" href="/categories/Android/">
                    Android <span class="right">1 篇</span></a>
                </a>
            </li>

        

            <li class="collapse-level-0" collapse-level="0">
                <a class="no-padding" href="/categories/Mac/">
                    Mac <span class="right">1 篇</span></a>
                </a>
            </li>

        

            <li class="collapse-level-0" collapse-level="0">
                <a class="no-padding" href="/categories/服务端/">
                    服务端 <span class="right">2 篇</span></a>
                </a>
            </li>

        

            <li class="collapse-level-0" collapse-level="0">
                <a class="no-padding" href="/categories/其它/">
                    其它 <span class="right">2 篇</span></a>
                </a>
            </li>

        

    </ul>
</div>

        </div>
    </div>
</nav>

<div id="search" class="modal search-modal">
    <div class="row">
        <div class="input-field col s12">
              <input id="search-input" type="text">
              <label for="search-input">搜索</label>
        </div>

    </div>
    <div id="search-result" class="search-result col s12">

    </div>
</div>


    <main>
        <div class="container main-container">
    
<nav class="page-nav hide-on-small-only">
    <div class="nav-wrapper blue-grey">
        <span class="breadcrumb">当前位置（分类目录）</span>
        
            
    
    
    <a class="breadcrumb" href="/categories/iOS/">iOS</a>


        

        
    </div>
</nav>

<article>
    <div class="card">
        <div class="card-content">
            

            <div class="article-title">
                
    
        <h1>开源项目-拼图验证控件TTGPuzzleVerify的实现</h1>
    


            </div>
            <time class="teal-link-context" datetime="2016-12-25T10:15:40.000Z"><a href="/2016/12/25/TTGPuzzleVerify/">2016-12-25</a></time>

            <span id="busuanzi_container_page_pv" class="read-times-container">
    <i class="fa fa-eye"></i>
    <span id="busuanzi_value_page_pv"></span>
</span>

            
    <div class="tags-row">
        
            <a href="/tags/原创/" class="chip teal accent-4">原创</a>
        
            <a href="/tags/iOS/" class="chip teal accent-4">iOS</a>
        
            <a href="/tags/开源/" class="chip teal accent-4">开源</a>
        
    </div>


            <div class="toc teal-link-context hide-on-med-and-down">
    <ol class="section table-of-contents"><li class="section table-of-contents-item section table-of-contents-level-2"><a class="section table-of-contents-link" href="#前言"><span class="section table-of-contents-text">前言</span></a></li><li class="section table-of-contents-item section table-of-contents-level-2"><a class="section table-of-contents-link" href="#分析"><span class="section table-of-contents-text">分析</span></a><ol class="section table-of-contents-child"><li class="section table-of-contents-item section table-of-contents-level-3"><a class="section table-of-contents-link" href="#组成部分"><span class="section table-of-contents-text">组成部分</span></a></li><li class="section table-of-contents-item section table-of-contents-level-3"><a class="section table-of-contents-link" href="#拆解步骤"><span class="section table-of-contents-text">拆解步骤</span></a></li><li class="section table-of-contents-item section table-of-contents-level-3"><a class="section table-of-contents-link" href="#关键技术点"><span class="section table-of-contents-text">关键技术点</span></a></li></ol></li><li class="section table-of-contents-item section table-of-contents-level-2"><a class="section table-of-contents-link" href="#实现"><span class="section table-of-contents-text">实现</span></a><ol class="section table-of-contents-child"><li class="section table-of-contents-item section table-of-contents-level-3"><a class="section table-of-contents-link" href="#拼图的路径生成"><span class="section table-of-contents-text">拼图的路径生成</span></a></li><li class="section table-of-contents-item section table-of-contents-level-3"><a class="section table-of-contents-link" href="#从图片上“抠出”拼图块、镂空"><span class="section table-of-contents-text">从图片上“抠出”拼图块、镂空</span></a></li><li class="section table-of-contents-item section table-of-contents-level-3"><a class="section table-of-contents-link" href="#用户拖动拼图、完成拼图验证"><span class="section table-of-contents-text">用户拖动拼图、完成拼图验证</span></a></li></ol></li><li class="section table-of-contents-item section table-of-contents-level-2"><a class="section table-of-contents-link" href="#最后"><span class="section table-of-contents-text">最后</span></a></li></ol>
</div>


            <div class="entry teal-link-context">
                <h2 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h2><p>最近抽空写了个拼图验证控件，用户可以通过水平、垂直，或者直接拖动拼图块，完成拼图图案，来完成验证。拼图块的形状可以自定义，默认提供了经典的拼图形状、圆形、正方形，整个拼图的图案也是支持从图片生成的。</p>
<p><strong>CocoaPods</strong>: <code>pod &quot;TTGPuzzleVerify&quot;</code><br><strong>Github</strong>: <a href="https://github.com/zekunyan/TTGPuzzleVerify" target="_blank" rel="external">https://github.com/zekunyan/TTGPuzzleVerify</a></p>
<p><img src="http://zorrochen.qiniudn.com/blog_TTGPuzzleVerify_gif.gif" alt=""></p>
<p>接下来，说说TTGPuzzleVerify的整体设计思路和实现原理。</p>
<a id="more"></a>
<h2 id="分析"><a href="#分析" class="headerlink" title="分析"></a>分析</h2><h3 id="组成部分"><a href="#组成部分" class="headerlink" title="组成部分"></a>组成部分</h3><p>先直观上分析一下控件的组成部分：</p>
<p><img src="http://zorrochen.qiniudn.com/blog_TTGPuzzleVerify_1.png" alt="组成部分"></p>
<p>可以直观看出，控件应该由三个部分组成：</p>
<ul>
<li>拼图块：就是从原图上<strong>“抠”</strong>出来的拼图形状的图片块</li>
<li>原始图片：拼图整体图案的图片</li>
<li>镂空背景：从原始图片上抠出拼图块以后，给用户提示用的，透明度更低的拼图块镂空背景</li>
</ul>
<h3 id="拆解步骤"><a href="#拆解步骤" class="headerlink" title="拆解步骤"></a>拆解步骤</h3><p>分析完了控件的组成，现在就来梳理一下控件的整个创建、交互流程。</p>
<p><img src="http://zorrochen.qiniudn.com/blog_TTGPuzzleVerify_2.png" alt="步骤"></p>
<ul>
<li>输入：图片、拼图形状、拼图大小、镂空的位置、拼图块的起始位置</li>
<li>生成拼图路径：根据拼图类型，生成对应的贝塞尔曲线</li>
<li>从图片抠出拼图块、镂空：有了拼图路径，就可以抠出拼图块和镂空的部分</li>
<li>设置位置、样式：根据参数设置拼图块的初始位置、样式，如阴影、镂空的透明度等</li>
<li>用户拖动：响应用户的头动手势，移动拼图块，根据坐标判断是否完成拼图</li>
<li>回调：用户完成拼图后，要回调，让外部响应拼图完成事件</li>
</ul>
<h3 id="关键技术点"><a href="#关键技术点" class="headerlink" title="关键技术点"></a>关键技术点</h3><p>从上面的步骤可以整理出来几个关键的技术点，如下：</p>
<p><strong>拼图的路径生成</strong><br>普通的形状，如正方形、圆形之类的还好，代码实现比较方便，但是复杂的拼图图案怎么办？</p>
<p><strong>从图片上“抠出”拼图块、镂空</strong><br>有了拼图的形状路径，如何从图片上抠出拼图块和镂空？</p>
<p><strong>用户拖动拼图、完成拼图验证</strong><br>抠出了拼图块，如何将用户的手势对应到移动拼图块，最终完成验证？</p>
<p>下面针对这三个点着重写下实现原理。</p>
<h2 id="实现"><a href="#实现" class="headerlink" title="实现"></a>实现</h2><h3 id="拼图的路径生成"><a href="#拼图的路径生成" class="headerlink" title="拼图的路径生成"></a>拼图的路径生成</h3><p>既然手写代码太难，那就从现有的图案生成代码。</p>
<p><strong>1. 找SVG素材</strong><br>既然要能随意改变大小，就要找矢量的图，Google “free svg”、“free icon”之类的，很容易就能找到免费的矢量图素材，例如TTGPuzzleVerify里面用的拼图形状就是从<a href="http://iconmonstr.com/puzzle-1/" target="_blank" rel="external">iconmonstr.com</a>找来的。</p>
<p><strong>2. 编辑</strong><br>直接下载回来的SVG还需要调整一下，如去除背景，我是用Sketch来编辑的。</p>
<p><img src="http://zorrochen.qiniudn.com/blog_TTGPuzzleVerify_3.png" alt="拼图SVG编辑"></p>
<p><strong>3. 生成代码</strong><br>拼图的路径本质上就是拼图的轮廓，在Sketch里面把拼图SVG的背景色等颜色删除，然后就是将其转换为代码。<br>这里可以用<a href="https://www.paintcodeapp.com/sketch" target="_blank" rel="external">PaintCode plugin for Sketch</a>，将Sketch的拼图矢量路径导出成代码。</p>
<p><strong>4. 调整代码</strong><br>直接生成的代码有时可能会不适用，可以人工调整下，然后就可以放到自己的类里面了：</p>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line">+ (<span class="built_in">UIBezierPath</span> *)classicPuzzlePath &#123;</div><div class="line">    <span class="keyword">static</span> <span class="built_in">UIBezierPath</span> *puzzleShape = <span class="literal">nil</span>;</div><div class="line"></div><div class="line">    <span class="keyword">static</span> <span class="built_in">dispatch_once_t</span> onceToken;</div><div class="line">    <span class="built_in">dispatch_once</span>(&amp;onceToken, ^&#123;</div><div class="line">        puzzleShape = [<span class="built_in">UIBezierPath</span> bezierPath];</div><div class="line">        [puzzleShape moveToPoint:<span class="built_in">CGPointMake</span>(<span class="number">17.45</span>, <span class="number">71.16</span>)];</div><div class="line">        <span class="comment">// 此处省略很多行=。=，PaintCode生成的</span></div><div class="line">        [puzzleShape closePath];</div><div class="line">    &#125;);</div><div class="line">    <span class="keyword">return</span> puzzleShape;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p><strong>5. UIBezierPath拼图路径的大小、位置调整</strong><br>直接导出的拼图路径的大小、位置是固定的，但是控件是要可以支持改变大小、位置的，所以，要对路径做变换，刚好<code>UIBezierPath</code>支持<code>CGAffineTransform</code>变换。</p>
<p>大小变换：</p>
<figure class="highlight arduino"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// 大小变换，path是生成的原始路径，_puzzleSize是传入的拼图块大小</span></div><div class="line">[path applyTransform:CGAffineTransformMakeScale(_puzzleSize.<span class="built_in">width</span> / path.bounds.<span class="built_in">size</span>.<span class="built_in">width</span>,</div><div class="line">                                                _puzzleSize.<span class="built_in">height</span> / path.bounds.<span class="built_in">size</span>.<span class="built_in">height</span>)];</div></pre></td></tr></table></figure>
<p>位置变换：</p>
<figure class="highlight dos"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">// 位置变换，<span class="built_in">path</span>是生成的原始路径，_puzzleBlankPosition是传入的拼图块、镂空位置</div><div class="line">[<span class="built_in">path</span> applyTransform:CGAffineTransformMakeTranslation(</div><div class="line">            _puzzleBlankPosition.x - <span class="built_in">path</span>.bounds.origin.x,</div><div class="line">            _puzzleBlankPosition.y - <span class="built_in">path</span>.bounds.origin.y)];</div></pre></td></tr></table></figure>
<p>至此，拼图的路径就写好了。</p>
<h3 id="从图片上“抠出”拼图块、镂空"><a href="#从图片上“抠出”拼图块、镂空" class="headerlink" title="从图片上“抠出”拼图块、镂空"></a>从图片上“抠出”拼图块、镂空</h3><p><strong>1. 拼图块</strong><br>有了UIBezierPath路径，抠出拼图块还是比较容易的，直接用<code>CAShapeLayer</code>来<strong>“mask”</strong>图片即可：</p>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// 拼图路径</span></div><div class="line"><span class="built_in">UIBezierPath</span> *puzzlePath = [<span class="keyword">self</span> getNewScaledPuzzledPath];</div><div class="line"></div><div class="line"><span class="comment">// 创建mask layer</span></div><div class="line"><span class="built_in">CAShapeLayer</span> *puzzleMaskLayer = [<span class="built_in">CAShapeLayer</span> new];</div><div class="line">puzzleMaskLayer.frame = <span class="keyword">self</span>.bounds;</div><div class="line">puzzleMaskLayer.path = puzzlePath.CGPath;</div><div class="line"></div><div class="line"><span class="comment">// Mask到图片imageView上</span></div><div class="line">_puzzleImageView.layer.mask = puzzleMaskLayer;</div></pre></td></tr></table></figure>
<p>效果就是：</p>
<p><img src="http://zorrochen.qiniudn.com/blog_TTGPuzzleVerify_4.png" alt="拼图块"></p>
<p><strong>2. 镂空图片</strong><br>抠出拼图块还是很容易的，但是“镂空”怎么办？<br>其实道理是一样的，都是<strong>mask</strong>，只不过mask的区域反过来而已。<br><code>CAShapeLayer</code>的<code>fillRule</code>就可以调整“填充的规则”，此处用<code>kCAFillRuleEvenOdd</code>就可以了，文档的解释如下：</p>
<blockquote>
<p>Specifies the even-odd winding rule. Count the total number of path crossings. If the number of crossings is even, the point is outside the path. If the number of crossings is odd, the point is inside the path and the region containing it should be filled.</p>
</blockquote>
<p>理解过来就是：区域内一点，往外划一条线，经过奇数个数的交点，则点在区域内，偶数个数的交点，则在区域外。</p>
<p>所以，只要在拼图路径的基础上，补充最外部的边框的路径即可：</p>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// 创建矩形边框路径</span></div><div class="line"><span class="built_in">UIBezierPath</span> *maskPath = [<span class="built_in">UIBezierPath</span> bezierPathWithRect:<span class="keyword">self</span>.bounds];</div><div class="line"><span class="comment">// 添加拼图路径</span></div><div class="line">[maskPath appendPath:[<span class="built_in">UIBezierPath</span> bezierPathWithCGPath:puzzlePath.CGPath]];</div><div class="line"><span class="comment">// 设置规则</span></div><div class="line">maskPath.usesEvenOddFillRule = <span class="literal">YES</span>;</div><div class="line"></div><div class="line"><span class="comment">// 创建mask的layer</span></div><div class="line"><span class="built_in">CAShapeLayer</span> *frontMaskLayer = [<span class="built_in">CAShapeLayer</span> new];</div><div class="line">frontMaskLayer.frame = <span class="keyword">self</span>.bounds;</div><div class="line">frontMaskLayer.path = maskPath.CGPath;</div><div class="line">frontMaskLayer.fillRule = kCAFillRuleEvenOdd; <span class="comment">// 填充规则</span></div><div class="line"></div><div class="line"><span class="comment">// 设置mask</span></div><div class="line">_frontImageView.layer.mask = frontMaskLayer;</div></pre></td></tr></table></figure>
<p>效果：</p>
<p><img src="http://zorrochen.qiniudn.com/blog_TTGPuzzleVerify_5.png" alt="镂空"></p>
<p><strong>3. 镂空背景</strong><br>有了拼图块、镂空，还差一块，就是镂空的“半透明背景”，其实这个“半透明背景”和拼图块是一模一样的，所以不再重复代码，唯一增加的就是设置其透明度。</p>
<p><strong>4. 组合</strong><br>将上面的组合到一起，就能形成最终的效果，从Reveal里面看到分层结构如下：</p>
<p><img src="http://zorrochen.qiniudn.com/blog_TTGPuzzleVerify_6.png" alt="分层"></p>
<p>其实就是三张一样的图片，按照不同的mask规则做了处理，叠加起来。</p>
<h3 id="用户拖动拼图、完成拼图验证"><a href="#用户拖动拼图、完成拼图验证" class="headerlink" title="用户拖动拼图、完成拼图验证"></a>用户拖动拼图、完成拼图验证</h3><p><strong>1. 拖动图片</strong><br>有了上面的结构，拖动拼图的处理也就容易多了，只要移动最上层的拼图块就行了，这里直接用<code>UIPanGestureRecognizer</code>实现，移动的时候基于拼图的中心移动。</p>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// 创建手势</span></div><div class="line"><span class="built_in">UIPanGestureRecognizer</span> *panGestureRecognizer = [<span class="built_in">UIPanGestureRecognizer</span> new];</div><div class="line">[panGestureRecognizer addTarget:<span class="keyword">self</span> action:<span class="keyword">@selector</span>(onPanGesture:)];</div><div class="line">[<span class="keyword">self</span> addGestureRecognizer:panGestureRecognizer];</div><div class="line"></div><div class="line"><span class="comment">// 手势处理</span></div><div class="line">- (<span class="keyword">void</span>)onPanGesture:(<span class="built_in">UIPanGestureRecognizer</span> *)panGestureRecognizer &#123;</div><div class="line">    <span class="comment">// 获取坐标</span></div><div class="line">    <span class="built_in">CGPoint</span> panLocation = [panGestureRecognizer locationInView:<span class="keyword">self</span>];</div><div class="line">    <span class="comment">// 拼图中心偏移</span></div><div class="line">    <span class="built_in">CGPoint</span> position = <span class="built_in">CGPointZero</span>;</div><div class="line">    position.x = panLocation.x - _puzzleSize.width / <span class="number">2</span>;</div><div class="line">    position.y = panLocation.y - _puzzleSize.height / <span class="number">2</span>;</div><div class="line">    <span class="comment">// 设置坐标</span></div><div class="line">    [<span class="keyword">self</span> setPuzzlePosition:position];</div><div class="line">    <span class="comment">// 判断、回调。。。</span></div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p><strong>2. 验证用户的拼图是否完成</strong><br>用户移动拼图时，只要判断拼图的坐标和镂空的位置是否一致就行。但是如果完全精确的判断，用户很难准确的把拼图拼对上，所以还要增加一定的<strong>“tolerance”</strong>，让拼图更加容易，同时暴漏出让外部设置：</p>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>, <span class="keyword">assign</span>) <span class="built_in">CGFloat</span> verificationTolerance; <span class="comment">// Verification tolerance, default is 8</span></div></pre></td></tr></table></figure>
<p>判断的逻辑如下：</p>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// puzzlePosition是当前拼图块的位置，_puzzleBlankPosition是拼图镂空的位置</span></div><div class="line">- (<span class="built_in">BOOL</span>)isVerified &#123;</div><div class="line">    <span class="keyword">return</span> fabsf([<span class="keyword">self</span> puzzlePosition].x - _puzzleBlankPosition.x) &lt;= _verificationTolerance &amp;&amp;</div><div class="line">           fabsf([<span class="keyword">self</span> puzzlePosition].y - _puzzleBlankPosition.y) &lt;= _verificationTolerance;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p><strong>3. 完成拼图</strong><br>当用户完成拼图后，外部会得到<code>delegate</code>、<code>block</code>的回调响应，接着就可以“完成拼图验证”，对此向外提供一个方法：<code>- (void)completeVerificationWithAnimation:(BOOL)withAnimation</code>，调用后拼图块将会移动回镂空位置，模拟出拼图完成的效果。</p>
<p>至此，TTGPuzzleVerify的关键实现技术点就是这些了～</p>
<h2 id="最后"><a href="#最后" class="headerlink" title="最后"></a>最后</h2><p>嗯，圣诞节快乐！ – 2016-12-25</p>

                
<p class="teal-link-context">
    <a href="/2017/03/08/quartzcode-demo-star-animation/" rel="next" title="用QuartzCode快速实现一个收藏动画">
    上一篇：用QuartzCode快速实现一个收藏动画
  </a>
</p>



<p class="teal-link-context">
    <a href="/2016/08/28/TTGBingWallPaper/" rel="next" title="Swift开源Mac App - BingWallPaper">
    下一篇：Swift开源Mac App - BingWallPaper
  </a>
</p>


            </div>

            
                <section class="reward">
                    </br>
                    <!-- Donate Module -->
<div id="donate_module">
    <style type="text/css">
        .hidden {
            display: none;
        }
        .donate_bar a.btn_donate {
            display: inline-block;
            width: 82px;
            height: 82px;
            background: url("http://img.t.sinajs.cn/t5/style/images/apps_PRF/e_media/btn_reward.gif") no-repeat;
            _background: url("http://img.t.sinajs.cn/t5/style/images/apps_PRF/e_media/btn_reward.gif") no-repeat;

            -webkit-transition: background 0s;
            -moz-transition: background 0s;
            -o-transition: background 0s;
            -ms-transition: background 0s;
            transition: background 0s;
        }
        .donate_bar a.btn_donate:hover {
            background-position: 0 -82px;
        }
        .donate_bar .donate_txt {
            display: block;
            color: #9d9d9d;
            font: 14px/2 "Microsoft Yahei";
        }
        .bold {
            font-weight: bold;
        }

        img.qrcode {
            width: 90%;
            margin-bottom: 10px;
        }
        @media only screen and (min-width: 1025px) {
            img.qrcode {
                width: 40%;
                margin-right: 10px;
            }
        }

    </style>

    <!-- btn_donate & tips -->
    <div id="donate_board" class="donate_bar center">
        <a id="btn_donate" class="btn_donate" target="_self" href="javascript:;" title="Donate 打赏"></a>
        <span class="donate_txt">能看到这的都是真爱，打个赏呗=。=</span>
    </div>
    <!-- /btn_donate & tips -->

    <!-- donate guide -->
    <div id="donate_guide" class="donate_bar center hidden">
        
        <img class="qrcode" src="http://zorrochen.qiniudn.com/blog_reward_weixinpay.JPG" title="打赏"/>
        
        <img class="qrcode" src="http://zorrochen.qiniudn.com/blog_reward_alipay.JPG" title="打赏"/>
        
    </div>
    <!-- /donate guide -->

    <!-- donate script -->
    <script type="text/javascript">
        document.getElementById('btn_donate').onclick = function() {
            $('#donate_board').addClass('hidden');
            $('#donate_guide').removeClass('hidden');
        }

        function donate_on_web() {
            $('#donate').submit();
        }
    </script>
    <!-- /donate script -->
</div>
<!-- /Donate Module -->

                </section>
            
			
        </div>
    </div>
</article>




    <div id="cloud-tie-wrapper" class="cloud-tie-wrapper"></div>
    <script>
      var cloudTieConfig = {
        url: document.location.href,
        sourceId: "",
        productKey: "a36947900dda436985a80d3b2f48b312",
        target: "cloud-tie-wrapper"
      };
    </script>
    <script src="https://img1.cache.netease.com/f2e/tie/yun/sdk/loader.js"></script>



</div>

        <div class="fixed-action-btn float-sitemap">
    <a class="btn-floating btn-large teal">
      <i class="fa fa-caret-square-o-up"></i>
    </a>
    <ul>
      <li><a class="btn-return-top btn-floating waves-effect teal accent-4" title="回到顶部"><i class="fa fa-arrow-circle-o-up"></i></a></li>
      <li><a class="btn-floating waves-effect button-collapse teal accent-4"  data-activates="main-menu" title="菜单"><i class="fa fa-navicon"></i></a></li>
    </ul>
  </div>

    </main>
    <footer class="page-footer blue-grey darken-1">
    
    <div class="footer-container container">
        <div class="row">
            
            <div class="social-group col m4 s12">
                <h5 class="white-text">社交</h5>
                
                    <a class="social-link" href="http://weibo.com/zekunyan" target="_blank">
                        <i class="fa fa-2x fa-weibo"></i>
                    </a>
                
                    <a class="social-link" href="https://github.com/zekunyan" target="_blank">
                        <i class="fa fa-2x fa-github"></i>
                    </a>
                
                    <a class="social-link" href="/atom.xml" target="_blank">
                        <i class="fa fa-2x fa-rss"></i>
                    </a>
                
                
    <script async src="//dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js">
    </script>
    <div class="site-visitors-container white-text">
        <span>
            <i class="fa fa-user"></i>
            <span class="busuanzi-value" id="busuanzi_value_site_uv"></span>
        </span>
        <span>&nbsp;|&nbsp;</span>
        <span>
            <i class="fa fa-eye"></i>
            <span class="busuanzi-value" id="busuanzi_value_site_pv"></span>
        </span>
    </div>


            </div>
            

            
            <div class="col m8 s12">
                <h5 class="white-text">友情链接</h5>
                
                    <a class="social-link" href="http://chenrudan.github.io/" target="_blank">女朋友的博客😊</a>
                
                    <a class="social-link" href="http://raytaylorlin.com/" target="_blank">raytaylorism主题作者的技术博客</a>
                
                    <a class="social-link" href="http://suta.name/" target="_blank">很赞的设计师</a>
                
                    <a class="social-link" href="http://neoyeelf.github.io/" target="_blank">NeOye&#39;s blog</a>
                
                    <a class="social-link" href="http://bingyan.farbox.com/" target="_blank">Howl写东西的地方</a>
                
            </div>
            
        </div>
    </div>
    

    <div class="footer-copyright teal-link-context">
        <div class="container">
            © 2017 tutuge.me, All rights reserved.
            <p class="right" style="margin-top: 0;">本博客由 <a href="https://hexo.io">Hexo</a> 强力驱动 | 主题 <a href="https://github.com/raytaylorlin/hexo-theme-raytaylorism">raytaylorism</a></p>
        </div>
    </div>
</footer>


    <noscript>
    <div class="noscript">
        <p class="center-align">当前网速较慢或者你使用的浏览器不支持博客特定功能，请尝试刷新或换用Chrome、Firefox等现代浏览器</p>
    </div>
</noscript>
<div class="noscript">
    <p class="center-align">当前网速较慢或者你使用的浏览器不支持博客特定功能，请尝试刷新或换用Chrome、Firefox等现代浏览器</p>
</div>


<script src="/js/jquery.min.js"></script>
<script src="/js/materialize.min.js"></script>

<script>
    (function($) {
        $(document).ready(function() {
            // 隐藏禁用javascript（针对微信内置浏览器）的提示
            $('.noscript').hide();

            // 图片缩放效果
            var $imgs = $('img').not('.slider-image').not('.avatar-image').not('.carousel-image').not('.card-cover-image').not('.qrcode');

            // 给图片加上点击放大效果（materialbox插件）
            $imgs.addClass('materialboxed').each(function(i, el) {
                $(this).attr('data-caption', $(this).attr('alt') || ' ');
            }).materialbox();

            // 优化表格的显示
            $('table').each(function() {
                var $table = $(this);
                // 除去多行代码的情况
                if ($table.find('pre').length == 0) {
                    $table.addClass('responsive-table striped bordered');
                }
            });

            // 首页幻灯片
            $('.slider').slider({indicators: true, full_width: true, interval: 8000});

            $(".button-collapse").sideNav();
            $(".category-menu").sideNav();

            // 针对gallery post
            $('.carousel').carousel({full_width: true});
            $('.carousel-control.prev').click(function() {
                $('.carousel').carousel('prev');
            });
            $('.carousel-control.next').click(function() {
                $('.carousel').carousel('next');
            });

            // 文章目录
            $('article').not('.simple-article').find('h1').add('h2').add('h3').add('h4').add('h5').add('h6').scrollSpy();

            // 目录随屏幕滚动（防止目录过长越过footer）
            var $toc = $('.toc');
            var scrollTargetTop = 0;
            $(window).scroll(function() {
                var $activeLink = $toc.find('a.active.section');
                if ($(window).scrollTop() < 100) {
                    scrollTargetTop = 0;
                } else {
                    if ($activeLink[0]) {
                        scrollTargetTop = $activeLink.offset().top - $toc.offset().top;
                    }
                }
                $toc.css('top', '-' + scrollTargetTop + 'px');
            });

            // 修正文章目录的left-border颜色
            var color = $('.table-of-contents-text').css('color');
            $('.table-of-contents-link').css('border-left-color', color);

            // 针对移动端做的优化：FAB按钮点击一下收回
            if (/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent)) {
                $('.fixed-action-btn').addClass('click-to-toggle');
            }
            // 回到顶部
            $('.btn-return-top').click(function() {
                $('body, html').animate({
                    scrollTop: 0
                }, 500);
            });

            // 重置读书页面的Tab标签页的颜色
            $('li.tab a').hover(function() {
                $(this).toggleClass('text-lighten-4');
            });
            $('.indicator').addClass('teal lighten-2');

            
            // 添加new标签
            $('.menu-about').append('<span class="new badge teal accent-4"></span>');
            

            // 搜索功能
            $('.modal-trigger').leanModal({
                // 打开搜索框时自动聚焦
                ready: function() {
                    if ($('#search').is(":visible")) {
                        $('#search-input').focus();
                    }
                }
            });
            var searchXml = "search.xml";
            if (searchXml.length == 0) {
             	searchXml = "search.xml";
            }
            var searchPath = "/" + searchXml;
            initSearch(searchPath, 'search-input', 'search-result');
        });

        // 初始化搜索与匹配函数
        var initSearch = function(path, search_id, content_id) {
            'use strict';
            $.ajax({
                url: path,
                dataType: "xml",
                success: function(xmlResponse) {
                    // get the contents from search data
                    var datas = $("entry", xmlResponse).map(function() {
                        return {
                            title: $("title", this).text(),
                            content: $("content", this).text(),
                            url: $("url", this).text()
                        };
                    }).get();
                    var $input = document.getElementById(search_id);
                    var $resultContent = document.getElementById(content_id);
                    $input.addEventListener('input', function() {
                        var str = '<ul class=\"search-result-list\">';
                        var keywords = this.value.trim().toLowerCase().split(/[\s\-]+/);
                        $resultContent.innerHTML = "";
                        if (this.value.trim().length <= 0) {
                            return;
                        }
                        // perform local searching
                        datas.forEach(function(data) {
                            var isMatch = true;
                            var content_index = [];
                            var data_title = data.title.trim().toLowerCase();
                            var data_content = data.content.trim().replace(/<[^>]+>/g, "").toLowerCase();
                            var data_url = data.url;
                            var index_title = -1;
                            var index_content = -1;
                            var first_occur = -1;
                            // only match artiles with not empty titles and contents
                            if (data_title != '' && data_content != '') {
                                keywords.forEach(function(keyword, i) {
                                    index_title = data_title.indexOf(keyword);
                                    index_content = data_content.indexOf(keyword);
                                    if (index_title < 0 && index_content < 0) {
                                        isMatch = false;
                                    } else {
                                        if (index_content < 0) {
                                            index_content = 0;
                                        }
                                        if (i == 0) {
                                            first_occur = index_content;
                                        }
                                    }
                                });
                            }
                            // show search results
                            if (isMatch) {
                                keywords.forEach(function(keyword) {
                                    var regS = new RegExp(keyword, "gi");
                                    data_title = data_title.replace(regS, "<span class=\"search-keyword teal lighten-2\">" + keyword + "</span>");
                                });

                                str += "<li><a href='" + data_url + "' class='search-result-title'>" + data_title + "</a>";
                                var content = data.content.trim().replace(/<[^>]+>/g, "");
                                if (first_occur >= 0) {
                                    // cut out 100 characters
                                    var start = first_occur - 20;
                                    var end = first_occur + 80;
                                    if (start < 0) {
                                        start = 0;
                                    }
                                    if (start == 0) {
                                        end = 100;
                                    }
                                    if (end > content.length) {
                                        end = content.length;
                                    }
                                    var match_content = content.substring(start, end);
                                    // highlight all keywords
                                    keywords.forEach(function(keyword) {
                                        var regS = new RegExp(keyword, "gi");
                                        match_content = match_content.replace(regS, "<span class=\"search-keyword teal lighten-2\">" + keyword + "</span>");
                                    });

                                    str += "<p class=\"search-result\">..." + match_content + "...</p>"
                                }
                                str += "</li>";
                            }
                        });
                        str += "</ul>";
                        $resultContent.innerHTML = str;
                    });
                }
            });
        }
    })(jQuery);
</script>


<script src="/js/prettify.js"></script>
<script type="text/javascript">
    $(document).ready(function() {
        $("pre").addClass("prettyprint");
        prettyPrint();
    });
</script>


<script>
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
        (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
            m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

    ga('create', 'UA-68058110-1', 'auto');
    ga('send', 'pageview');

</script>



<script type="text/javascript" src="http://tajs.qq.com/stats?sId=55079830" charset="UTF-8"></script>





</body>
</html>
