<!DOCTYPE HTML>
<html>
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="chrome=1">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">

    

    <title>æœ‰è¶£çš„Autolayoutç¤ºä¾‹5-Masonryå®ç° | iOSï¼ŒAndroidç¨‹åºçŒ¿ï¼Œå–œæ¬¢Macã€Linuxã€å„ç§å¼€æºæŠ€æœ¯ï¼Œå„ç§è¯­è¨€</title>
    <meta name="author" content="ç‡•æ³½å ƒ">
    
    <meta name="description" content="ç¨‹åºçŒ¿">
    
    
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">

    <meta property="og:title" content="æœ‰è¶£çš„Autolayoutç¤ºä¾‹5-Masonryå®ç°"/>
    <meta property="og:site_name" content="åœŸåœŸå“¥çš„æŠ€æœ¯Blog"/>

    
    <meta property="og:image" content="undefined"/>
    

    <link rel="icon" type="image/png" href="/favicon.png">
    <link rel="alternate" href="/atom.xml" title="åœŸåœŸå“¥çš„æŠ€æœ¯Blog" type="application/atom+xml">
    <link rel="stylesheet" href="/css/lib/materialize.min.css">
    <link rel="stylesheet" href="/css/lib/font-awesome.min.css">
    <link rel="stylesheet" href="/css/style.css" media="screen" type="text/css">

    
        <link rel="stylesheet" href="/css/lib/prettify-tomorrow-night-eighties.css" type="text/css">
    
    <!--[if lt IE 9]><script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script><![endif]-->
</head>


<body>
    <img src="/weixin_favicon.png" style="position: absolute; left: -9999px; opacity: 0; filter: alpha(opacity=0);">

    <nav class="blue-grey">
    <div class="nav-wrapper">
        <a href="#" data-activates="main-menu" class="button-collapse">
            <i class="fa fa-navicon"></i>
        </a>
        <div class="">
            <a href="/" class="brand-logo hide-on-med-and-down">åœŸåœŸå“¥çš„æŠ€æœ¯Blog</a>
            <ul class="right hide-on-med-and-down">
                
                    <li>
                        <a class="menu-home " href="/" >
                            <i class="fa fa-home "></i>
                            
                            é¦–é¡µ
                        </a>
                    </li>
                
                    <li>
                        <a class="menu-archive " href="/archives" >
                            <i class="fa fa-archive "></i>
                            
                            å½’æ¡£
                        </a>
                    </li>
                
                    <li>
                        <a class="menu-category category-menu" href="javascript:;" data-activates="category-menu" >
                            <i class="fa fa-bookmark "></i>
                            
                            åˆ†ç±»
                        </a>
                    </li>
                
                    <li>
                        <a class="menu-about " href="/about" >
                            <i class="fa fa-user "></i>
                            
                            å…³äº
                        </a>
                    </li>
                
                    <li>
                        <a class="menu-search modal-trigger " href="#search" >
                            <i class="fa fa-search "></i>
                            
                            æœç´¢
                        </a>
                    </li>
                
            </ul>
            <div>
    <ul class="side-nav blue-grey darken-1" id="main-menu">
        
        <li class="side-user">
            <div class="row">
                <div class="col s4 no-padding">
                    <img class="avatar-image circle responsive-img" src="http://7nj2iz.com1.z0.glb.clouddn.com/avatar_comic_big.png" alt="User Avatar">
                </div>
                <div class="info col s8 valign-wrapper no-padding">
                    <div class="valign">
                        <p class="name">åœŸåœŸå“¥</p>
                        <p class="desc">iOS/Android/æŠ€æœ¯å®…</p>
                    </div>
                </div>
            </div>
        </li>
        

        
            <li class="no-padding">
                <a class="waves-effect menu-home " href="/" >
                    <i class="fa fa-home "></i>
                    
                    é¦–é¡µ
                </a>
            </li>
        
            <li class="no-padding">
                <a class="waves-effect menu-archive " href="/archives" >
                    <i class="fa fa-archive "></i>
                    
                    å½’æ¡£
                </a>
            </li>
        
            <li class="no-padding">
                <a class="waves-effect menu-category category-menu" href="javascript:;" data-activates="category-menu" >
                    <i class="fa fa-bookmark "></i>
                    
                    åˆ†ç±»
                </a>
            </li>
        
            <li class="no-padding">
                <a class="waves-effect menu-about " href="/about" >
                    <i class="fa fa-user "></i>
                    
                    å…³äº
                </a>
            </li>
        
            <li class="no-padding">
                <a class="waves-effect menu-search modal-trigger " href="#search" >
                    <i class="fa fa-search "></i>
                    
                    æœç´¢
                </a>
            </li>
        
    </ul>

    <ul class="side-nav blue-grey darken-1" id="category-menu">
    

            

            <li class="collapse-level-0" collapse-level="0">
                <a class="no-padding" href="/categories/iOS/">
                    iOS <span class="right">37 ç¯‡</span></a>
                </a>
            </li>

        

            <li class="collapse-level-0" collapse-level="0">
                <a class="no-padding" href="/categories/Android/">
                    Android <span class="right">1 ç¯‡</span></a>
                </a>
            </li>

        

            <li class="collapse-level-0" collapse-level="0">
                <a class="no-padding" href="/categories/Mac/">
                    Mac <span class="right">1 ç¯‡</span></a>
                </a>
            </li>

        

            <li class="collapse-level-0" collapse-level="0">
                <a class="no-padding" href="/categories/æœåŠ¡ç«¯/">
                    æœåŠ¡ç«¯ <span class="right">2 ç¯‡</span></a>
                </a>
            </li>

        

            <li class="collapse-level-0" collapse-level="0">
                <a class="no-padding" href="/categories/å…¶å®ƒ/">
                    å…¶å®ƒ <span class="right">2 ç¯‡</span></a>
                </a>
            </li>

        

    </ul>
</div>

        </div>
    </div>
</nav>

<div id="search" class="modal search-modal">
    <div class="row">
        <div class="input-field col s12">
              <input id="search-input" type="text">
              <label for="search-input">æœç´¢</label>
        </div>

    </div>
    <div id="search-result" class="search-result col s12">

    </div>
</div>


    <main>
        <div class="container main-container">
    <nav class="page-nav hide-on-small-only">
    <div class="nav-wrapper blue-grey">
        <span class="breadcrumb">å½“å‰ä½ç½®ï¼ˆåˆ†ç±»ç›®å½•ï¼‰</span>
        
            
    
    
    <a class="breadcrumb" href="/categories/iOS/">iOS</a>


        

        
    </div>
</nav>

<article>
    <div class="card">
        <div class="card-content">
            

            <div class="article-title">
                
    
        <h1>æœ‰è¶£çš„Autolayoutç¤ºä¾‹5-Masonryå®ç°</h1>
    


            </div>
            <time class="teal-link-context" datetime="2017-03-12T13:41:17.000Z"><a href="/2017/03/12/autolayout-example-with-masonry5/">2017-03-12</a></time>

            <span id="busuanzi_container_page_pv" class="read-times-container">
    <i class="fa fa-eye"></i>
    <span id="busuanzi_value_page_pv"></span>
</span>

            
    <div class="tags-row">
        
            <a href="/tags/åŸåˆ›/" class="chip teal accent-4">åŸåˆ›</a>
        
            <a href="/tags/iOS/" class="chip teal accent-4">iOS</a>
        
            <a href="/tags/Autolayout/" class="chip teal accent-4">Autolayout</a>
        
            <a href="/tags/Masonry/" class="chip teal accent-4">Masonry</a>
        
    </div>


            <div class="toc teal-link-context hide-on-med-and-down">
    <ol class="section table-of-contents"><li class="section table-of-contents-item section table-of-contents-level-2"><a class="section table-of-contents-link" href="#å‰è¨€"><span class="section table-of-contents-text">å‰è¨€</span></a></li><li class="section table-of-contents-item section table-of-contents-level-2"><a class="section table-of-contents-link" href="#Case1-UITableViewCellä¸­å¤šä¸ªå˜é«˜çš„Label"><span class="section table-of-contents-text">Case1: UITableViewCellä¸­å¤šä¸ªå˜é«˜çš„Label</span></a><ol class="section table-of-contents-child"><li class="section table-of-contents-item section table-of-contents-level-3"><a class="section table-of-contents-link" href="#å®ç°åŠŸèƒ½"><span class="section table-of-contents-text">å®ç°åŠŸèƒ½</span></a></li><li class="section table-of-contents-item section table-of-contents-level-3"><a class="section table-of-contents-link" href="#åŸç†"><span class="section table-of-contents-text">åŸç†</span></a></li><li class="section table-of-contents-item section table-of-contents-level-3"><a class="section table-of-contents-link" href="#ä»£ç ç»†èŠ‚"><span class="section table-of-contents-text">ä»£ç ç»†èŠ‚</span></a></li></ol></li><li class="section table-of-contents-item section table-of-contents-level-2"><a class="section table-of-contents-link" href="#Case2-StairViewè‡ªå®šä¹‰Viewå®ç°intrinsicContentSize"><span class="section table-of-contents-text">Case2: StairViewè‡ªå®šä¹‰Viewå®ç°intrinsicContentSize</span></a><ol class="section table-of-contents-child"><li class="section table-of-contents-item section table-of-contents-level-3"><a class="section table-of-contents-link" href="#å®ç°åŠŸèƒ½-1"><span class="section table-of-contents-text">å®ç°åŠŸèƒ½</span></a></li><li class="section table-of-contents-item section table-of-contents-level-3"><a class="section table-of-contents-link" href="#intrinsicContentSizeæ˜¯ä»€ä¹ˆ"><span class="section table-of-contents-text">intrinsicContentSizeæ˜¯ä»€ä¹ˆ</span></a></li><li class="section table-of-contents-item section table-of-contents-level-3"><a class="section table-of-contents-link" href="#StairViewçš„å®ç°"><span class="section table-of-contents-text">StairViewçš„å®ç°</span></a><ol class="section table-of-contents-child"><li class="section table-of-contents-item section table-of-contents-level-4"><a class="section table-of-contents-link" href="#APIè®¾è®¡"><span class="section table-of-contents-text">APIè®¾è®¡</span></a></li><li class="section table-of-contents-item section table-of-contents-level-4"><a class="section table-of-contents-link" href="#å†…éƒ¨å±æ€§"><span class="section table-of-contents-text">å†…éƒ¨å±æ€§</span></a></li><li class="section table-of-contents-item section table-of-contents-level-4"><a class="section table-of-contents-link" href="#è®¾ç½®é˜¶æ¢¯æ ‡é¢˜-setStairTitles-çš„å®ç°"><span class="section table-of-contents-text">è®¾ç½®é˜¶æ¢¯æ ‡é¢˜: setStairTitles:çš„å®ç°</span></a></li><li class="section table-of-contents-item section table-of-contents-level-4"><a class="section table-of-contents-link" href="#å†…éƒ¨é˜¶æ¢¯Labelçš„å¸ƒå±€-intrinsicContentSizeçš„è®¡ç®—-updateStairLayoutçš„å®ç°"><span class="section table-of-contents-text">å†…éƒ¨é˜¶æ¢¯Labelçš„å¸ƒå±€+intrinsicContentSizeçš„è®¡ç®—: updateStairLayoutçš„å®ç°</span></a></li><li class="section table-of-contents-item section table-of-contents-level-4"><a class="section table-of-contents-link" href="#é€šçŸ¥å¤–ç•Œå†…å®¹å¤§å°å‘ç”Ÿå˜åŒ–-invalidateIntrinsicContentSizeæ–¹æ³•"><span class="section table-of-contents-text">é€šçŸ¥å¤–ç•Œå†…å®¹å¤§å°å‘ç”Ÿå˜åŒ–-invalidateIntrinsicContentSizeæ–¹æ³•</span></a></li><li class="section table-of-contents-item section table-of-contents-level-4"><a class="section table-of-contents-link" href="#å…³é”®ï¼šä½•æ—¶è°ƒç”¨updateStairLayoutæ›´æ–°å¸ƒå±€ã€åˆ·æ–°contentSize"><span class="section table-of-contents-text">å…³é”®ï¼šä½•æ—¶è°ƒç”¨updateStairLayoutæ›´æ–°å¸ƒå±€ã€åˆ·æ–°contentSize</span></a></li></ol></li><li class="section table-of-contents-item section table-of-contents-level-3"><a class="section table-of-contents-link" href="#è‡ªå®šä¹‰Viewå°ç»“"><span class="section table-of-contents-text">è‡ªå®šä¹‰Viewå°ç»“</span></a></li></ol></li><li class="section table-of-contents-item section table-of-contents-level-2"><a class="section table-of-contents-link" href="#Case3-ç»™åŒä¸€ä¸ªå±æ€§æ·»åŠ å¤šé‡çº¦æŸï¼Œå®ç°å¤æ‚å…³ç³»"><span class="section table-of-contents-text">Case3: ç»™åŒä¸€ä¸ªå±æ€§æ·»åŠ å¤šé‡çº¦æŸï¼Œå®ç°å¤æ‚å…³ç³»</span></a><ol class="section table-of-contents-child"><li class="section table-of-contents-item section table-of-contents-level-3"><a class="section table-of-contents-link" href="#åŒºåˆ†è§‚å¿µï¼šFrameå¸ƒå±€å’ŒAutolayoutçš„ä¸åŒ"><span class="section table-of-contents-text">åŒºåˆ†è§‚å¿µï¼šFrameå¸ƒå±€å’ŒAutolayoutçš„ä¸åŒ</span></a></li><li class="section table-of-contents-item section table-of-contents-level-3"><a class="section table-of-contents-link" href="#ä»£ç ç»†èŠ‚-1"><span class="section table-of-contents-text">ä»£ç ç»†èŠ‚</span></a></li></ol></li><li class="section table-of-contents-item section table-of-contents-level-2"><a class="section table-of-contents-link" href="#æœ€å"><span class="section table-of-contents-text">æœ€å</span></a></li></ol>
</div>


            <div class="entry teal-link-context">
                <h2 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h2><p>ç¬¬äº”ç¯‡æ¥äº†ï¼<br>è¿˜æ˜¯3ä¸ªå°ä¾‹å­ï¼Œä»ç„¶æ˜¯ä¸»è¦éƒ¨åˆ†ç”¨Masonryæ‰‹å†™ä»£ç å®ç°ï¼Œå…¶å®ƒçš„çº¦æŸåœ¨storyboardé‡Œé¢ç›´æ¥æ‹–æ‹½æ­å»ºã€‚ä¸‰ä¸ªä¾‹å­åˆ†åˆ«æ˜¯ï¼š  </p>
<ol>
<li>UITableViewCellä¸­å¤šä¸ªå˜é«˜çš„Label</li>
<li>StairViewè‡ªå®šä¹‰Viewçš„<code>intrinsicContentSize</code>ï¼Œå¹¶æ”¯æŒåœ¨UITableViewCellä¸­è‡ªåŠ¨è®¡ç®—é«˜åº¦</li>
<li>ç»™åŒä¸€ä¸ªå±æ€§æ·»åŠ <strong>å¤šé‡çº¦æŸ</strong>ï¼Œå®ç°å¤æ‚å…³ç³»</li>
</ol>
<p><img src="http://zorrochen.qiniudn.com/blog_autolayout_example_with_masonry5_1.png" alt=""></p>
<p>å‰å››ç¯‡ï¼š  </p>
<ul>
<li>ç¬¬ä¸€ç¯‡ï¼š<a href="http://tutuge.me/2015/05/23/autolayout-example-with-masonry/">æœ‰è¶£çš„Autolayoutç¤ºä¾‹-Masonryå®ç°</a>  </li>
<li>ç¬¬äºŒç¯‡ï¼š<a href="http://tutuge.me/2015/08/08/autolayout-example-with-masonry2/">æœ‰è¶£çš„Autolayoutç¤ºä¾‹2-Masonryå®ç°</a>  </li>
<li>ç¬¬ä¸‰ç¯‡ï¼š<a href="http://tutuge.me/2015/12/14/autolayout-example-with-masonry3/">æœ‰è¶£çš„Autolayoutç¤ºä¾‹3-Masonryå®ç°</a></li>
<li>ç¬¬å››ç¯‡ï¼š<a href="http://tutuge.me/2016/08/06/autolayout-example-with-masonry4/">æœ‰è¶£çš„Autolayoutç¤ºä¾‹4-Masonryå®ç°</a></li>
</ul>
<p>Githubåœ°å€ï¼š<br><a href="https://github.com/zekunyan/AutolayoutExampleWithMasonry" target="_blank" rel="external">https://github.com/zekunyan/AutolayoutExampleWithMasonry</a></p>
<a id="more"></a>
<h2 id="Case1-UITableViewCellä¸­å¤šä¸ªå˜é«˜çš„Label"><a href="#Case1-UITableViewCellä¸­å¤šä¸ªå˜é«˜çš„Label" class="headerlink" title="Case1: UITableViewCellä¸­å¤šä¸ªå˜é«˜çš„Label"></a>Case1: UITableViewCellä¸­å¤šä¸ªå˜é«˜çš„Label</h2><h3 id="å®ç°åŠŸèƒ½"><a href="#å®ç°åŠŸèƒ½" class="headerlink" title="å®ç°åŠŸèƒ½"></a>å®ç°åŠŸèƒ½</h3><p>åŠŸèƒ½å°±æ˜¯Cellæ•´ä½“å˜é«˜ï¼Œå†…éƒ¨æ°´å¹³ä¸‰ä¸ªLabelï¼Œå®½åº¦ä¸€æ ·ï¼Œé«˜åº¦ç”±å†…å®¹å†³å®šã€‚</p>
<p>åœ¨æœ¬ä¾‹å­ä¸­ï¼ŒLabelçš„å®½åº¦å®šä¸º80ï¼Œé¿å…å¤šè¡ŒLabelçš„<code>preferredMaxLayoutWidth</code>çš„è®¾ç½®å¹²æ‰°ã€‚</p>
<h3 id="åŸç†"><a href="#åŸç†" class="headerlink" title="åŸç†"></a>åŸç†</h3><p>åŸç†ä¸€å¥è¯å°±æ˜¯ï¼šCellçš„é«˜åº¦ç”±ä¸‰ä¸ªLabelä¸­æœ€é«˜çš„å¾—å‡ºã€‚</p>
<p>ä½†æ˜¯ï¼Œå®é™…è®¾ç½®Autolayoutçš„æ—¶å€™ï¼Œä¸å­˜åœ¨ä»€ä¹ˆ<code>cell.height = MAX(labels.height)</code>è¿™æ ·çš„å…³ç³»ã€‚</p>
<p>æ‰€ä»¥è¦è½¬æ¢ä¸€ä¸‹ï¼Œæ”¹ä¸º<strong><code>ANY(label.bottom) &lt;= cell.bottom</code></strong>ï¼Œå³<strong>æ¯ä¸ªLabelçš„åº•éƒ¨bottoméƒ½æ˜¯åœ¨cellçš„åº•éƒ¨bottomä¸Šé¢çš„</strong>ï¼Œæ¢ç®—åˆ°åæ ‡ç³»é‡Œé¢ï¼Œå°±æ˜¯åœ¨Yè½´ä¸Šï¼Œ<strong><code>label.bottom &lt;= cell.bottom</code></strong>ã€‚</p>
<p>æ‰€ä»¥ï¼Œcellçš„çº¦æŸå¦‚ä¸‹å›¾æ‰€ç¤ºï¼š</p>
<p><img src="http://zorrochen.qiniudn.com/blog_autolayout_example_with_masonry5_2.png" alt=""></p>
<h3 id="ä»£ç ç»†èŠ‚"><a href="#ä»£ç ç»†èŠ‚" class="headerlink" title="ä»£ç ç»†èŠ‚"></a>ä»£ç ç»†èŠ‚</h3><p>å¯¹åº”çš„ä»£ç å¦‚ä¸‹ï¼š</p>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div></pre></td><td class="code"><pre><div class="line">- (<span class="keyword">void</span>)setupLayout &#123;</div><div class="line">    <span class="comment">// label1çš„çº¦æŸ    </span></div><div class="line">    [_label1 mas_makeConstraints:^(MASConstraintMaker *make) &#123;</div><div class="line">        make.width.equalTo(@<span class="number">80</span>); <span class="comment">// å®½åº¦80</span></div><div class="line">        make.top.equalTo(<span class="keyword">self</span>.contentView.mas_topMargin); <span class="comment">// ä¸Š</span></div><div class="line">        make.left.equalTo(<span class="keyword">self</span>.contentView.mas_leftMargin); <span class="comment">// å·¦</span></div><div class="line">        <span class="comment">// label.bottom &lt;= cell.contentView.bottomï¼Œæ³¨æ„æ˜¯åœ¨Yè½´ä¸Šå¯¹æ¯”</span></div><div class="line">        make.bottom.lessThanOrEqualTo(<span class="keyword">self</span>.contentView.mas_bottomMargin); </div><div class="line">    &#125;];</div><div class="line">    </div><div class="line">    <span class="comment">// label2çš„çº¦æŸ </span></div><div class="line">    <span class="comment">// ç±»ä¼¼...</span></div><div class="line">    <span class="comment">// label3çš„çº¦æŸ </span></div><div class="line">    <span class="comment">// ç±»ä¼¼...</span></div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h2 id="Case2-StairViewè‡ªå®šä¹‰Viewå®ç°intrinsicContentSize"><a href="#Case2-StairViewè‡ªå®šä¹‰Viewå®ç°intrinsicContentSize" class="headerlink" title="Case2: StairViewè‡ªå®šä¹‰Viewå®ç°intrinsicContentSize"></a>Case2: StairViewè‡ªå®šä¹‰Viewå®ç°<code>intrinsicContentSize</code></h2><h3 id="å®ç°åŠŸèƒ½-1"><a href="#å®ç°åŠŸèƒ½-1" class="headerlink" title="å®ç°åŠŸèƒ½"></a>å®ç°åŠŸèƒ½</h3><p>å®ç°ä¸€ä¸ªè‡ªå®šä¹‰å¸ƒå±€çš„View - StairViewï¼Œé˜¶æ¢¯å¸ƒå±€Viewã€‚<br>StairViewæ”¯æŒè®¾ç½®Labelæˆé˜¶æ¢¯çŠ¶ä»ä¸Šåˆ°ä¸‹ã€ä»å·¦åˆ°å³åˆ†å¸ƒï¼Œå¦‚ä¸‹å›¾ï¼š</p>
<p><img src="http://zorrochen.qiniudn.com/blog_autolayout_example_with_masonry5_3.jpg" alt=""></p>
<p>åŒæ—¶ï¼ŒStairViewè¦æ”¯æŒAutolayoutï¼Œæ”¯æŒå¤§å°ç”±å†…å®¹å†³å®šï¼Œå¯ä»¥åœ¨Cellé‡Œé¢ç”¨ï¼Œå¹¶è‡ªåŠ¨è®¡ç®—é«˜åº¦ã€‚</p>
<p>æ¥ä¸‹æ¥ï¼Œçœ‹çœ‹å¦‚ä½•å®ç°è¿™ä¸ªStairViewã€‚</p>
<h3 id="intrinsicContentSizeæ˜¯ä»€ä¹ˆ"><a href="#intrinsicContentSizeæ˜¯ä»€ä¹ˆ" class="headerlink" title="intrinsicContentSizeæ˜¯ä»€ä¹ˆ"></a>intrinsicContentSizeæ˜¯ä»€ä¹ˆ</h3><p>å¦‚æœè¯´åˆ°Autolayoutçš„å†…å®¹å†³å®šå¤§å°ï¼Œå°±ä¼šé‡åˆ°<code>intrinsicContentSize</code>æ–¹æ³•ï¼Œè¿™ä¸ªæ–¹æ³•æ˜¯ä»€ä¹ˆå‘¢ï¼Ÿ</p>
<p>intrinsicå•è¯çš„æ„æ€ï¼š</p>
<blockquote>
<p>adj.å›ºæœ‰çš„ï¼Œå†…åœ¨çš„ï¼Œæœ¬è´¨çš„ï¼› [è§£å‰–]ä½“å†…çš„ï¼› æœ¬å¾ï¼› å…ˆå¤©æ€§</p>
</blockquote>
<p>è€Œ<code>intrinsicContentSize</code>æ–¹æ³•çš„å®˜æ–¹è§£é‡Šæ˜¯ï¼š</p>
<blockquote>
<p>Returns the natural size for the receiving view, considering only properties of the view itself.</p>
</blockquote>
<p>æ‰€ä»¥ï¼ŒUIViewçš„<code>intrinsicContentSize</code>ï¼Œå°±æ˜¯è·å–è¿™ä¸ªViewçš„<strong>å›ºæœ‰çš„ï¼Œå†…åœ¨çš„ï¼Œæœ¬è´¨çš„</strong>çš„<strong>å†…å®¹å¤§å°</strong>ã€‚</p>
<p>åœ¨çœ‹Discussionéƒ¨åˆ†ï¼š</p>
<blockquote>
<p>Custom views typically have content that they display of which the layout system is unaware. Overriding this method allows a custom view to communicate to the layout system what size it would like to be based on its content. This intrinsic size must be independent of the content frame, because thereâ€™s no way to dynamically communicate a changed width to the layout system based on a changed height, for example.</p>
</blockquote>
<p>æ¯”è¾ƒé•¿ï¼Œç®€å•è¯´ï¼Œå°±æ˜¯Autolayoutå¸ƒå±€ç³»ç»Ÿæ˜¯ä¸çŸ¥é“è‡ªå®šä¹‰Viewçš„å†…å®¹å¤§å°çš„ï¼Œæ‰€ä»¥è‡ªå®šä¹‰Viewå¯ä»¥é‡å†™è¿™ä¸ªæ–¹æ³•ï¼Œè¿”å›è‡ªå·±çš„<strong>å†…å®¹å¤§å°</strong>ï¼Œäº¤ç”±Autolayoutå¸ƒå±€ç³»ç»Ÿå»è®¡ç®—å¸ƒå±€ã€‚å¹¶ä¸”ï¼Œè¿™ä¸ªå¤§å°æ˜¯ä¸èƒ½ä¾èµ–å¤–éƒ¨çš„å¤§å°çš„ã€‚</p>
<p>æ‰€ä»¥ï¼Œå¦‚æœæˆ‘ä»¬çš„Viewçš„å¤§å°æ˜¯å›ºå®šçš„æ—¶å€™ï¼Œæœ€ç®€å•ï¼Œç›´æ¥è¿”å›å³å¯ï¼š</p>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">- (<span class="built_in">CGSize</span>)intrinsicContentSize &#123;</div><div class="line">    <span class="keyword">return</span> <span class="built_in">CGSizeMake</span>(<span class="number">100</span>, <span class="number">100</span>); <span class="comment">// å›ºå®š100x100å¤§å°</span></div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>å¦‚æœå¤§å°éœ€è¦è®¡ç®—ï¼Œå°±è¦å…ˆè®¡ç®—ï¼Œç„¶åè¿”å›ï¼š</p>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">- (<span class="built_in">CGSize</span>)intrinsicContentSize &#123;</div><div class="line">    <span class="comment">// å…ˆè®¡ç®—å†…å®¹å¤§å°ï¼Œå¯ä»¥æŒ‰æƒ…å†µç¼“å­˜ï¼Œå‡å°‘è®¡ç®—é‡</span></div><div class="line">    <span class="built_in">CGSize</span> contentSize = [<span class="keyword">self</span> calculateContentSize];</div><div class="line">    <span class="comment">// è¿”å›</span></div><div class="line">    <span class="keyword">return</span> contentSize;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>æœ‰äº†<code>intrinsicContentSize</code>çš„è¿”å›å¤§å°ï¼ŒAutolayoutçš„å¸ƒå±€ç³»ç»Ÿæ‰èƒ½æ­£ç¡®çš„å¸ƒå±€ã€‚</p>
<h3 id="StairViewçš„å®ç°"><a href="#StairViewçš„å®ç°" class="headerlink" title="StairViewçš„å®ç°"></a>StairViewçš„å®ç°</h3><p>æ¸…æ¥šäº†<code>intrinsicContentSize</code>çš„ä½œç”¨ä»¥åï¼Œå°±å¯ä»¥ç€æ‰‹å®ç°StairViewäº†ã€‚</p>
<h4 id="APIè®¾è®¡"><a href="#APIè®¾è®¡" class="headerlink" title="APIè®¾è®¡"></a>APIè®¾è®¡</h4><p>ä¸ºäº†å°½é‡ç®€å•ï¼ŒStairViewçš„æ–¹æ³•åªæœ‰ä¸€ä¸ªï¼š</p>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="comment">/**</span></div><div class="line"> *  è®¾ç½®é˜¶æ¢¯title</div><div class="line"> *  @param titles æ ‡é¢˜æ•°ç»„</div><div class="line"> */</div><div class="line">- (<span class="keyword">void</span>)setStairTitles:(<span class="built_in">NSArray</span> &lt;<span class="built_in">NSString</span> *&gt; *)titles;</div></pre></td></tr></table></figure>
<p>ç›´æ¥ä¼ å…¥å­—ç¬¦ä¸²æ•°ç»„å³å¯ã€‚</p>
<h4 id="å†…éƒ¨å±æ€§"><a href="#å†…éƒ¨å±æ€§" class="headerlink" title="å†…éƒ¨å±æ€§"></a>å†…éƒ¨å±æ€§</h4><p>StairViewå†…éƒ¨ç”±UILabelç»„æˆå®ç°ï¼Œæ‰€ä»¥éœ€è¦ä¸€ä¸ªæ•°ç»„ä¿å­˜æ‰€æœ‰çš„Labelï¼Œè¿˜è¦ä¸€ä¸ªCGSizeç±»å‹çš„å˜é‡ï¼Œä¿å­˜å½“å‰çš„å†…å®¹å¤§å°ï¼š</p>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">StairView</span> ()</span></div><div class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>, <span class="keyword">strong</span>) <span class="built_in">NSMutableArray</span> &lt;<span class="built_in">UILabel</span> *&gt; *itemViews; <span class="comment">// Labelæ•°ç»„</span></div><div class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>, <span class="keyword">assign</span>) <span class="built_in">CGSize</span> contentSize; <span class="comment">// å†…å®¹å¤§å°ï¼Œéšæ—¶æ›´æ–°</span></div><div class="line"><span class="keyword">@end</span></div></pre></td></tr></table></figure>
<h4 id="è®¾ç½®é˜¶æ¢¯æ ‡é¢˜-setStairTitles-çš„å®ç°"><a href="#è®¾ç½®é˜¶æ¢¯æ ‡é¢˜-setStairTitles-çš„å®ç°" class="headerlink" title="è®¾ç½®é˜¶æ¢¯æ ‡é¢˜: setStairTitles:çš„å®ç°"></a>è®¾ç½®é˜¶æ¢¯æ ‡é¢˜: setStairTitles:çš„å®ç°</h4><p>æ¥ç€å°±æ˜¯å®ç°<code>setStairTitles:</code>æ–¹æ³•ã€‚<br>åŸºæœ¬é€»è¾‘å°±æ˜¯: <code>åˆ é™¤æ—§çš„Label-&gt;å¾ªç¯åˆ›å»ºæ–°çš„Label-&gt;é‡æ–°å¸ƒå±€</code>ï¼š</p>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div></pre></td><td class="code"><pre><div class="line">- (<span class="keyword">void</span>)setStairTitles:(<span class="built_in">NSArray</span>&lt;<span class="built_in">NSString</span> *&gt; *)titles &#123;</div><div class="line">    <span class="comment">// æ‰¹é‡ä»superViewåˆ é™¤æ—§çš„Label</span></div><div class="line">    [_itemViews makeObjectsPerformSelector:<span class="keyword">@selector</span>(removeFromSuperview)];</div><div class="line">    </div><div class="line">    <span class="comment">// é‡æ–°åˆ›å»º</span></div><div class="line">    _itemViews = [<span class="built_in">NSMutableArray</span> new];</div><div class="line">    </div><div class="line">    <span class="comment">// å¾ªç¯åˆ›å»ºæ–°çš„Label</span></div><div class="line">    <span class="keyword">for</span> (<span class="built_in">NSString</span> *title <span class="keyword">in</span> titles) &#123;</div><div class="line">        <span class="built_in">UILabel</span> *label = [<span class="built_in">UILabel</span> new];</div><div class="line">        <span class="comment">// è®¾ç½®æ ·å¼</span></div><div class="line">        label.text = title;</div><div class="line">        label.font = [<span class="built_in">UIFont</span> systemFontOfSize:<span class="number">12</span>];</div><div class="line">        label.layer.borderColor = [<span class="built_in">UIColor</span> lightGrayColor].CGColor;</div><div class="line">        label.layer.borderWidth = <span class="number">1.0</span>f / [<span class="built_in">UIScreen</span> mainScreen].scale;</div><div class="line">        label.numberOfLines = <span class="number">0</span>;</div><div class="line">        [<span class="keyword">self</span> addSubview:label];</div><div class="line">        <span class="comment">// æ·»åŠ Label</span></div><div class="line">        [_itemViews addObject:label];</div><div class="line">    &#125;</div><div class="line">    </div><div class="line">    <span class="comment">// é‡æ–°å¸ƒå±€</span></div><div class="line">    _contentSize = <span class="built_in">CGSizeZero</span>;</div><div class="line">    </div><div class="line">    <span class="comment">// é‡ç‚¹ï¼</span></div><div class="line">    [<span class="keyword">self</span> updateStairLayout];</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h4 id="å†…éƒ¨é˜¶æ¢¯Labelçš„å¸ƒå±€-intrinsicContentSizeçš„è®¡ç®—-updateStairLayoutçš„å®ç°"><a href="#å†…éƒ¨é˜¶æ¢¯Labelçš„å¸ƒå±€-intrinsicContentSizeçš„è®¡ç®—-updateStairLayoutçš„å®ç°" class="headerlink" title="å†…éƒ¨é˜¶æ¢¯Labelçš„å¸ƒå±€+intrinsicContentSizeçš„è®¡ç®—: updateStairLayoutçš„å®ç°"></a>å†…éƒ¨é˜¶æ¢¯Labelçš„å¸ƒå±€+intrinsicContentSizeçš„è®¡ç®—: updateStairLayoutçš„å®ç°</h4><p>ä»ä¸Šé¢çš„è®¾ç½®ä»£ç å¯çœ‹å‡ºï¼Œé‡ç‚¹æ˜¯å¯¹å†…éƒ¨Labelå¸ƒå±€çš„<code>updateStairLayout</code>æ–¹æ³•ï¼ŒæŒ‰ç…§å‰é¢æ‰€è¯´çš„åŠŸèƒ½è¦æ±‚ï¼ŒåŸºæœ¬çš„åŸç†å°±æ˜¯:<br><code>æ ¹æ®å½“å‰é˜¶æ¢¯æ•°é‡è®¡ç®—æ¯ä¸ªLabelçš„å¹³å‡width-&gt;éå†æ‰€æœ‰Labelè®¡ç®—å½“å‰widthä¸‹çš„é«˜åº¦-&gt;è®¾ç½®æ¯ä¸ªLabelçš„frame-&gt;æ›´æ–°contentSize</code></p>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div></pre></td><td class="code"><pre><div class="line">- (<span class="keyword">void</span>)updateStairLayout &#123;</div><div class="line">    <span class="keyword">if</span> (_itemViews.count == <span class="number">0</span>) &#123;</div><div class="line">        <span class="comment">// æ²¡æœ‰è®¾ç½®å†…å®¹ï¼Œå†…å®¹å¤§å°ä¸ºé›¶</span></div><div class="line">        _contentSize = <span class="built_in">CGSizeZero</span>;</div><div class="line">        <span class="keyword">return</span>;</div><div class="line">    &#125;</div><div class="line">    </div><div class="line">    <span class="comment">// è®¡ç®—æ¯ä¸ªLabelçš„å¹³å‡å®½åº¦</span></div><div class="line">    <span class="built_in">CGFloat</span> eachLabelWidth = <span class="built_in">CGRectGetWidth</span>(<span class="keyword">self</span>.bounds) / (<span class="built_in">CGFloat</span>)_itemViews.count;</div><div class="line">    <span class="built_in">CGFloat</span> lastY = <span class="number">0</span>;</div><div class="line">    <span class="built_in">CGFloat</span> lastX = <span class="number">0</span>;</div><div class="line">    </div><div class="line">    <span class="keyword">for</span> (<span class="built_in">UILabel</span> *label <span class="keyword">in</span> _itemViews) &#123;</div><div class="line">        <span class="comment">// æ ¹æ®å†…å®¹ã€å½“å‰widthè®¡ç®—é«˜åº¦</span></div><div class="line">        label.preferredMaxLayoutWidth = eachLabelWidth;</div><div class="line">        <span class="built_in">CGFloat</span> height = [label sizeThatFits:<span class="built_in">CGSizeMake</span>(eachLabelWidth, <span class="number">0</span>)].height;</div><div class="line">        </div><div class="line">        <span class="comment">// è®¾ç½®frame</span></div><div class="line">        <span class="built_in">CGRect</span> frame = <span class="built_in">CGRectMake</span>(lastX, lastY, eachLabelWidth, height);</div><div class="line">        label.frame = frame;</div><div class="line">        </div><div class="line">        <span class="comment">// æ›´æ–°ä¸‹ä¸€è½®</span></div><div class="line">        lastX += eachLabelWidth;</div><div class="line">        lastY += height;</div><div class="line">    &#125;</div><div class="line">    </div><div class="line">    <span class="comment">// æ›´æ–°contentSize</span></div><div class="line">    <span class="built_in">CGSize</span> newContentSize = <span class="built_in">CGSizeMake</span>(<span class="built_in">CGRectGetWidth</span>(<span class="keyword">self</span>.bounds), lastY);</div><div class="line">    </div><div class="line">    <span class="comment">// åˆ¤æ–­å†…å®¹å¤§å°æ˜¯å¦æœ‰å˜åŒ–</span></div><div class="line">    <span class="keyword">if</span> (!<span class="built_in">CGSizeEqualToSize</span>(newContentSize, _contentSize)) &#123;</div><div class="line">        <span class="comment">// æ›´æ–°contentSize</span></div><div class="line">        _contentSize = newContentSize;</div><div class="line">        </div><div class="line">        <span class="comment">// é€šçŸ¥å¤–éƒ¨IntrinsicContentSizeå¤±æ•ˆ</span></div><div class="line">        [<span class="keyword">self</span> invalidateIntrinsicContentSize];</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<ul>
<li>è¦å…ˆåˆ¤æ–­è®¾ç½®çš„é˜¶æ¢¯titleæ•°é‡æ˜¯å¦ä¸ºé›¶ï¼Œå¦åˆ™è®¡ç®—å¹³å‡å®½åº¦æ—¶ä¼šå¯¼è‡´é™¤æ•°ä¸ºé›¶çš„Crash</li>
<li>æ¯ä¸ªLabelçš„é«˜åº¦ï¼Œæ ¹æ®å½“å‰çš„å¹³å‡å®½åº¦ï¼Œç”¨<code>sizeThatFits:</code>è®¡ç®—å¾—å‡º</li>
<li>æœ€åæ›´æ–°<code>_contentSize</code>çš„å€¼</li>
<li>é‡ç‚¹ï¼<code>[self invalidateIntrinsicContentSize]</code>é€šçŸ¥å¤–ç•Œï¼ŒStairViewçš„å†…å®¹å¤§å°å‘ç”Ÿå˜åŒ–</li>
</ul>
<p>è®¡ç®—å†…éƒ¨Labelå¸ƒå±€çš„åŸç†è¿˜æ˜¯å¾ˆç®€å•çš„ï¼Œé‡ç‚¹å°±æ˜¯æœ€åçš„æ›´æ–°<code>_contentSize</code>å’Œè°ƒç”¨<code>[self invalidateIntrinsicContentSize]</code>ã€‚</p>
<h4 id="é€šçŸ¥å¤–ç•Œå†…å®¹å¤§å°å‘ç”Ÿå˜åŒ–-invalidateIntrinsicContentSizeæ–¹æ³•"><a href="#é€šçŸ¥å¤–ç•Œå†…å®¹å¤§å°å‘ç”Ÿå˜åŒ–-invalidateIntrinsicContentSizeæ–¹æ³•" class="headerlink" title="é€šçŸ¥å¤–ç•Œå†…å®¹å¤§å°å‘ç”Ÿå˜åŒ–-invalidateIntrinsicContentSizeæ–¹æ³•"></a>é€šçŸ¥å¤–ç•Œå†…å®¹å¤§å°å‘ç”Ÿå˜åŒ–-invalidateIntrinsicContentSizeæ–¹æ³•</h4><p>å…ˆçœ‹çœ‹å®˜æ–¹æ–‡æ¡£çš„è§£é‡Šï¼š</p>
<blockquote>
<p>Call this when something changes in your custom view that invalidates its intrinsic content size. This allows the constraint-based layout system to take the new intrinsic content size into account in its next layout pass.</p>
</blockquote>
<p>æ„æ€å°±æ˜¯ï¼Œå½“è‡ªå®šä¹‰Viewçš„å†…å®¹å¤§å°å‘ç”Ÿå˜åŒ–æ—¶ï¼Œè°ƒç”¨æ­¤æ–¹æ³•é€šçŸ¥å¸ƒå±€ç³»ç»Ÿï¼Œåœ¨ä¸‹ä¸€æ¬¡å¸ƒå±€æ›´æ–°ä¸­åˆ·æ–°ã€‚</p>
<p>æ‰€ä»¥ï¼Œå¯¹ç…§ä¸Šé¢çš„ä»£ç :</p>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// åˆ¤æ–­å†…å®¹å¤§å°æ˜¯å¦æœ‰å˜åŒ–</span></div><div class="line"><span class="keyword">if</span> (!<span class="built_in">CGSizeEqualToSize</span>(newContentSize, _contentSize)) &#123;</div><div class="line">    <span class="comment">// æ›´æ–°contentSize</span></div><div class="line">    _contentSize = newContentSize;</div><div class="line">    </div><div class="line">    <span class="comment">// é€šçŸ¥å¤–éƒ¨IntrinsicContentSizeå¤±æ•ˆ</span></div><div class="line">    [<span class="keyword">self</span> invalidateIntrinsicContentSize];</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>å°±å¾ˆæ˜æ˜¾äº†ï¼Œå°±æ˜¯æŒ‰ç…§æ–‡æ¡£çš„è¯´æ˜åšçš„ã€‚</p>
<h4 id="å…³é”®ï¼šä½•æ—¶è°ƒç”¨updateStairLayoutæ›´æ–°å¸ƒå±€ã€åˆ·æ–°contentSize"><a href="#å…³é”®ï¼šä½•æ—¶è°ƒç”¨updateStairLayoutæ›´æ–°å¸ƒå±€ã€åˆ·æ–°contentSize" class="headerlink" title="å…³é”®ï¼šä½•æ—¶è°ƒç”¨updateStairLayoutæ›´æ–°å¸ƒå±€ã€åˆ·æ–°contentSize"></a>å…³é”®ï¼šä½•æ—¶è°ƒç”¨updateStairLayoutæ›´æ–°å¸ƒå±€ã€åˆ·æ–°contentSize</h4><p>æœ‰äº†<code>updateStairLayout</code>æ–¹æ³•æ¥å¸ƒå±€ã€è®¡ç®—contentSizeï¼Œä¹Ÿç”¨äº†<code>invalidateIntrinsicContentSize</code>é€šçŸ¥ç³»ç»Ÿåˆ·æ–°ï¼Œé‚£ä¹ˆå‰©ä¸‹æ¥çš„å…³é”®å°±æ˜¯<strong>ä½•æ—¶ä½•åœ°è°ƒç”¨æ›´æ–°å¸ƒå±€ã€contentSize</strong></p>
<p><strong>åœ¨<code>layoutSubviews</code>çš„æ—¶å€™</strong><br>è¿™é‡Œå¾ˆæ˜æ˜¾ï¼Œ<code>layoutSubviews</code>å°±æ˜¯åˆ·æ–°è‡ªå®šä¹‰viewçš„åœ°æ–¹ï¼Œç³»ç»Ÿä¼šåœ¨å¸ƒå±€çš„è¿‡ç¨‹ä¸­ï¼Œå¤šæ¬¡è°ƒç”¨ï¼Œå¦‚frameæ”¹å˜ã€‚</p>
<p><strong>åœ¨<code>intrinsicContentSize</code>çš„æ—¶å€™</strong><br>è¿™é‡Œæ¯”è¾ƒå®¹æ˜“å¿½è§†ï¼Œæœ‰æ—¶å€™ï¼Œç³»ç»Ÿè°ƒç”¨<code>intrinsicContentSize</code>æ–¹æ³•çš„æ—¶å€™ï¼Œå¯èƒ½åœ¨è‡ªå®šä¹‰Viewçš„å¸ƒå±€ä¹‹å‰ï¼Œæ‰€ä»¥è¿™ä¸ªæ—¶å€™è¦â€œå¼ºåˆ¶â€åˆ·æ–°å¸ƒå±€ã€è®¡ç®—å‡ºå½“å‰çŠ¶æ€ä¸‹æ­£ç¡®çš„contentSize</p>
<p>æ‰€ä»¥ï¼Œæœ‰ä¸¤å¤„åœ°æ–¹è¦åŠ ä¸Šï¼š</p>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line">- (<span class="built_in">CGSize</span>)intrinsicContentSize &#123;</div><div class="line">    [<span class="keyword">self</span> updateStairLayout];</div><div class="line">    <span class="keyword">return</span> _contentSize;</div><div class="line">&#125;</div><div class="line"></div><div class="line">- (<span class="keyword">void</span>)layoutSubviews &#123;</div><div class="line">    [<span class="keyword">super</span> layoutSubviews];</div><div class="line">    [<span class="keyword">self</span> updateStairLayout];</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h3 id="è‡ªå®šä¹‰Viewå°ç»“"><a href="#è‡ªå®šä¹‰Viewå°ç»“" class="headerlink" title="è‡ªå®šä¹‰Viewå°ç»“"></a>è‡ªå®šä¹‰Viewå°ç»“</h3><p>StairViewçš„åŸç†ã€ä»£ç éƒ½è®²å®Œäº†ï¼Œç®—æ˜¯ä¸€ä¸ªå…¸å‹çš„è‡ªå®šä¹‰çš„ã€æ ¹æ®å†…å®¹å†³å®šé«˜åº¦çš„Viewæ¡ˆä¾‹ï¼Œä¸»è¦è¦æ³¨æ„çš„å°±æ˜¯<strong>æ›´æ–°å¸ƒå±€ã€contentSizeçš„æ—¶æœº</strong>ï¼Œä»¥åŠ<strong>åŠæ—¶invalidateIntrinsicContentSizeé€šçŸ¥å¸ƒå±€ç³»ç»Ÿæ›´æ–°</strong></p>
<h2 id="Case3-ç»™åŒä¸€ä¸ªå±æ€§æ·»åŠ å¤šé‡çº¦æŸï¼Œå®ç°å¤æ‚å…³ç³»"><a href="#Case3-ç»™åŒä¸€ä¸ªå±æ€§æ·»åŠ å¤šé‡çº¦æŸï¼Œå®ç°å¤æ‚å…³ç³»" class="headerlink" title="Case3: ç»™åŒä¸€ä¸ªå±æ€§æ·»åŠ å¤šé‡çº¦æŸï¼Œå®ç°å¤æ‚å…³ç³»"></a>Case3: ç»™åŒä¸€ä¸ªå±æ€§æ·»åŠ <strong>å¤šé‡çº¦æŸ</strong>ï¼Œå®ç°å¤æ‚å…³ç³»</h2><p>è¿™ä¸ªCaseä¸»è¦æ˜¯ä¸ºäº†çº æ­£ä¸€ä¸ªå¯èƒ½çš„è¯¯åŒºï¼š<strong>Autolayouté‡Œé¢ï¼ŒåŒä¸€ä¸ªå±æ€§ï¼Œæ˜¯å¯ä»¥åŠ ä¸Šå¤šé‡çº¦æŸçš„</strong>ï¼Œæˆ–è€…è¯´ï¼ŒåŒä¸€ä¸ªViewçš„åŒä¸€ä¸ªå±æ€§ï¼Œå¯ä»¥å‚ä¸åˆ°å¤šä¸ªçº¦æŸé‡Œé¢çš„ã€‚</p>
<p>å…ˆçœ‹çœ‹Caseçš„åŠŸèƒ½ï¼š</p>
<p><img src="http://zorrochen.qiniudn.com/blog_autolayout_example_with_masonry5_4.jpg" alt=""></p>
<p>æ³¨æ„åˆ°ï¼Œå³è¾¹ç»¿è‰²labelçš„å·¦è¾¹ï¼Œä¸ä»…è¦å¤§äºå·¦è¾¹è“è‰²labelçš„å³è¾¹ï¼Œè¿˜è¦å¤§äºæ•´ä½“å®½åº¦çš„1/3ï¼Œæ‰€ä»¥ï¼Œæ˜¯è¦<strong>åŒæ—¶æ»¡è¶³å¤šæ¡çº¦æŸæ¡ä»¶çš„</strong>ã€‚</p>
<h3 id="åŒºåˆ†è§‚å¿µï¼šFrameå¸ƒå±€å’ŒAutolayoutçš„ä¸åŒ"><a href="#åŒºåˆ†è§‚å¿µï¼šFrameå¸ƒå±€å’ŒAutolayoutçš„ä¸åŒ" class="headerlink" title="åŒºåˆ†è§‚å¿µï¼šFrameå¸ƒå±€å’ŒAutolayoutçš„ä¸åŒ"></a>åŒºåˆ†è§‚å¿µï¼šFrameå¸ƒå±€å’ŒAutolayoutçš„ä¸åŒ</h3><p><strong>æŒ‰ç…§Frameå¸ƒå±€</strong></p>
<p>æŒ‰ç…§ä¼ ç»Ÿçš„ç”¨Frameå¸ƒå±€çš„æ–¹å¼ï¼Œlabelçš„å·¦è¾¹ï¼Œå…¶å®å°±æ˜¯<code>label.frame.origin.x</code>è¿™ä¸ªå±æ€§ï¼Œæ‰€ä»¥ï¼Œè¦å·¦è¾¹æ»¡è¶³æ¡ä»¶çš„è¯ï¼Œé¦–å…ˆæƒ³åˆ°çš„å¯èƒ½å°±æ˜¯ï¼š</p>
<figure class="highlight maxima"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">// æ»¡è¶³å¤§äºè“è‰²<span class="built_in">label</span>çš„å³è¾¹</div><div class="line"><span class="built_in">label</span>.frame.<span class="built_in">origin</span>.x &gt; blueLabel1.frame.<span class="built_in">origin</span>.x + blueLabel1.frame.size.<span class="built_in">width</span>;</div><div class="line"><span class="built_in">label</span>.frame.<span class="built_in">origin</span>.x &gt; blueLabel2.frame.<span class="built_in">origin</span>.x + blueLabel2.frame.size.<span class="built_in">width</span>;</div><div class="line"><span class="built_in">label</span>.frame.<span class="built_in">origin</span>.x &gt; blueLabel3.frame.<span class="built_in">origin</span>.x + blueLabel3.frame.size.<span class="built_in">width</span>;</div><div class="line">// æ»¡è¶³å¤§äºæ•´ä½“çš„<span class="number">1</span>/<span class="number">3</span></div><div class="line"><span class="built_in">label</span>.frame.<span class="built_in">origin</span>.x &gt; (superView.frame.<span class="built_in">origin</span>.x + superView.frame.size.<span class="built_in">width</span>) / <span class="number">3</span></div></pre></td></tr></table></figure>
<p>è¿™ï¼Œä¹ä¸€çœ‹ï¼Œå°±æ˜¯ä¸åœçš„åœ¨<code>layoutSubView</code>çš„æ—¶å€™åšåˆ¤æ–­ã€å¤„ç†ã€‚</p>
<p><strong>æŒ‰ç…§Autolayoutå¸ƒå±€</strong></p>
<p>è€ŒAutolayoutæ˜¯ä»€ä¹ˆï¼Œæ˜¯<strong>çº¦æŸ</strong>ï¼Œæ˜¯ä¸€ç§å¸ƒå±€å…³ç³»ï¼Œåªæ˜¯å¯¹å…·ä½“Viewçš„ç›¸å…³å±æ€§çš„ä¸€ç§å…³ç³»è®¾ç½®ï¼Œæˆ‘ä»¬è®¾ç½®äº†çº¦æŸï¼Œç³»ç»Ÿå°±ä¼šåœ¨éœ€è¦çš„æ—¶å€™ï¼ŒæŒ‰ç…§çº¦æŸï¼Œè®¡ç®—å‡ºæ¯ä¸ªViewçš„frameï¼Œè‡ªåŠ¨æ›´æ–°ã€‚</p>
<p>æ‰€ä»¥ï¼ŒåŒä¸€ä¸ªå±æ€§ï¼Œå®Œå…¨æ˜¯å¯ä»¥åŠ å¤šä¸ªçº¦æŸæ¡ä»¶çš„ã€‚</p>
<h3 id="ä»£ç ç»†èŠ‚-1"><a href="#ä»£ç ç»†èŠ‚-1" class="headerlink" title="ä»£ç ç»†èŠ‚"></a>ä»£ç ç»†èŠ‚</h3><p>ä¸€æ—¦æ²¡æœ‰äº†ä¸€ä¸ªå±æ€§ä¸€ä¸ªçº¦æŸçš„<strong>è§‚å¿µé™åˆ¶</strong>ï¼Œè¿™ä¸ªCaseçš„åŠŸèƒ½å°±å¾ˆå¥½å®ç°äº†ï¼Œå…³é”®ä»£ç å¦‚ä¸‹ï¼š</p>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// åˆ›å»ºç»¿è‰²label</span></div><div class="line">_greenLabel = [<span class="built_in">UILabel</span> new];</div><div class="line">[_containerView addSubview:_greenLabel];</div><div class="line"></div><div class="line"><span class="comment">// è®¾ç½®å†…å®¹æŠ—å‹ä¼˜å…ˆçº§æœ€é«˜</span></div><div class="line">[_greenLabel setContentCompressionResistancePriority:<span class="built_in">UILayoutPriorityRequired</span> forAxis:<span class="built_in">UILayoutConstraintAxisHorizontal</span>];</div><div class="line"></div><div class="line">[_greenLabel mas_makeConstraints:^(MASConstraintMaker *make) &#123;</div><div class="line">    <span class="comment">// å‚ç›´å±…ä¸­</span></div><div class="line">    make.centerY.equalTo(_containerView);</div><div class="line">    </div><div class="line">    <span class="comment">// å³è¾¹ä¸è¶…å‡º</span></div><div class="line">    make.right.lessThanOrEqualTo(_containerView);</div><div class="line">    </div><div class="line">    <span class="comment">// å·¦è¾¹å¤§äºç­‰äºçˆ¶Viewå®½åº¦çš„1/3ï¼Œæ³¨æ„ä¸æ˜¯widthå±æ€§</span></div><div class="line">    make.left.greaterThanOrEqualTo(_containerView.mas_right).multipliedBy((<span class="built_in">CGFloat</span>)(<span class="number">1.0</span>f / <span class="number">3.0</span>f));</div><div class="line">    </div><div class="line">    <span class="comment">// å¾ªç¯ï¼Œå·¦è¾¹å¤§äºæ‰€æœ‰å·¦è¾¹labelçš„å³è¾¹+8</span></div><div class="line">    <span class="keyword">for</span> (<span class="built_in">UILabel</span> *label <span class="keyword">in</span> _leftLabels) &#123;</div><div class="line">        make.left.greaterThanOrEqualTo(label.mas_right).offset(<span class="number">8</span>);</div><div class="line">    &#125;</div><div class="line">&#125;];</div></pre></td></tr></table></figure>
<p>åªè¦çº¦æŸæ²¡æœ‰å†²çªï¼Œæˆ‘ä»¬è®¾ç½®çš„çº¦æŸï¼Œå°±å¯ä»¥åœ¨å„ç§æƒ…å†µä¸‹ï¼ŒæŒ‰ç…§éœ€è¦ç”Ÿæ•ˆã€‚<br>å¯¹äºè¿™ç§å†…å®¹åŠ¨æ€å˜åŒ–ï¼ŒViewä¹‹é—´å…³ç³»å¤æ‚çš„æƒ…å†µï¼Œç”¨Autolayoutå°±éå¸¸æœ‰æ•ˆäº†ã€‚</p>
<h2 id="æœ€å"><a href="#æœ€å" class="headerlink" title="æœ€å"></a>æœ€å</h2><p>è¿™ä¸ªç³»åˆ—å±…ç„¶å·²ç»å‡ºåˆ°äº†ç¬¬äº”ç¯‡äº†ï¼Œè‡ªå·±éƒ½è§‰å¾—ä¸å¯æ€è®®=ã€‚=<br>æ‰€æœ‰çš„ä¾‹å­éƒ½æ˜¯æ—¥å¸¸å·¥ä½œä¸­é‡åˆ°ã€æƒ³åˆ°çš„ï¼Œè§‰å¾—ç®—æ˜¯ä¸€ä¸ªç‚¹ï¼Œå°±æŠŠå®ƒè®°å½•äº†ä¸‹æ¥ï¼Œä»¥åä¼šä¸€ç›´åšæŒä¸‹å»ï½</p>

                
<p class="teal-link-context">
    <a href="/2017/03/14/xcode8-crash-on-out-parameter/" rel="next" title="åç¼–è¯‘åˆ†æXcode8çš„Bug, releaseä¸‹è¿ç»­ä¸¤æ¬¡è°ƒç”¨æœ‰äºŒçº§æŒ‡é’ˆå‚æ•°çš„ç©ºæ–¹æ³•ä¼šCrash">
    ä¸Šä¸€ç¯‡ï¼šåç¼–è¯‘åˆ†æXcode8çš„Bug, releaseä¸‹è¿ç»­ä¸¤æ¬¡è°ƒç”¨æœ‰äºŒçº§æŒ‡é’ˆå‚æ•°çš„ç©ºæ–¹æ³•ä¼šCrash
  </a>
</p>



<p class="teal-link-context">
    <a href="/2017/03/11/TTGDeallocTaskHelper/" rel="next" title="åœ¨å¯¹è±¡deallocçš„åæœŸæ‰§è¡ŒTask-å¼€æºåº“TTGDeallocTaskHelper">
    ä¸‹ä¸€ç¯‡ï¼šåœ¨å¯¹è±¡deallocçš„åæœŸæ‰§è¡ŒTask-å¼€æºåº“TTGDeallocTaskHelper
  </a>
</p>


            </div>
			
        </div>
    </div>
</article>

<div id="cloud-tie-wrapper" class="cloud-tie-wrapper"></div>
<script>
  var cloudTieConfig = {
    url: document.location.href, 
    sourceId: "",
    productKey: "a36947900dda436985a80d3b2f48b312",
    target: "cloud-tie-wrapper"
  };
</script>
<script src="https://img1.cache.netease.com/f2e/tie/yun/sdk/loader.js"></script>

</div>

        <div class="fixed-action-btn float-sitemap">
    <a class="btn-floating btn-large teal">
      <i class="fa fa-caret-square-o-up"></i>
    </a>
    <ul>
      <li><a class="btn-return-top btn-floating waves-effect teal accent-4" title="å›åˆ°é¡¶éƒ¨"><i class="fa fa-arrow-circle-o-up"></i></a></li>
      <li><a class="btn-floating waves-effect button-collapse teal accent-4"  data-activates="main-menu" title="menu"><i class="fa fa-navicon"></i></a></li>
    </ul>
  </div>

    </main>
    <footer class="page-footer blue-grey darken-1">
    
    <div class="container">
        <div class="row">
            
            <div class="social-group col m4 s12">
                <h5 class="white-text">ç¤¾äº¤</h5>
                
                    <a class="social-link" href="http://weibo.com/zekunyan" target="_blank">
                        <i class="fa fa-2x fa-weibo"></i>
                    </a>
                
                    <a class="social-link" href="https://github.com/zekunyan" target="_blank">
                        <i class="fa fa-2x fa-github"></i>
                    </a>
                
                    <a class="social-link" href="/atom.xml" target="_blank">
                        <i class="fa fa-2x fa-rss"></i>
                    </a>
                
                <div class="site-visitors-container white-text">
                    <span>
                        <i class="fa fa-user"></i>
                        <span class="busuanzi-value" id="busuanzi_value_site_uv"></span>
                    </span>
                    <span>&nbsp;|&nbsp;</span>
                    <span>
                        <i class="fa fa-eye"></i>
                        <span class="busuanzi-value" id="busuanzi_value_site_pv"></span>
                    </span>
                </div>
            </div>
            

            
            <div class="col m8 s12">
                <h5 class="white-text">å‹æƒ…é“¾æ¥</h5>
                
                    <a class="social-link" href="http://chenrudan.github.io/" target="_blank">å¥³æœ‹å‹çš„åšå®¢ğŸ˜Š</a>
                
                    <a class="social-link" href="http://raytaylorlin.com/" target="_blank">raytaylorismä¸»é¢˜ä½œè€…çš„æŠ€æœ¯åšå®¢</a>
                
                    <a class="social-link" href="http://suta.name/" target="_blank">å¾ˆèµçš„è®¾è®¡å¸ˆ</a>
                
                    <a class="social-link" href="http://neoyeelf.github.io/" target="_blank">NeOye&#39;s blog</a>
                
                    <a class="social-link" href="http://bingyan.farbox.com/" target="_blank">Howlå†™ä¸œè¥¿çš„åœ°æ–¹</a>
                
            </div>
            
        </div>
    </div>
    

    <div class="footer-copyright teal-link-context">
        <div class="container">
            Â© 2017 tutuge.me, All rights reserved.
            <p class="right" style="margin-top: 0;">æœ¬åšå®¢ç”± <a href="https://hexo.io">Hexo</a> å¼ºåŠ›é©±åŠ¨ | ä¸»é¢˜ <a href="https://github.com/raytaylorlin/hexo-theme-raytaylorism">raytaylorism</a></p>
        </div>
    </div>
</footer>


    <noscript>
    <div class="noscript">
        <p class="center-align">å½“å‰ç½‘é€Ÿè¾ƒæ…¢æˆ–è€…ä½ ä½¿ç”¨çš„æµè§ˆå™¨ä¸æ”¯æŒåšå®¢ç‰¹å®šåŠŸèƒ½ï¼Œè¯·å°è¯•åˆ·æ–°æˆ–æ¢ç”¨Chromeã€Firefoxç­‰ç°ä»£æµè§ˆå™¨</p>
    </div>
</noscript>
<div class="noscript">
    <p class="center-align">å½“å‰ç½‘é€Ÿè¾ƒæ…¢æˆ–è€…ä½ ä½¿ç”¨çš„æµè§ˆå™¨ä¸æ”¯æŒåšå®¢ç‰¹å®šåŠŸèƒ½ï¼Œè¯·å°è¯•åˆ·æ–°æˆ–æ¢ç”¨Chromeã€Firefoxç­‰ç°ä»£æµè§ˆå™¨</p>
</div>


<script src="/js/jquery.min.js"></script>
<script src="/js/materialize.min.js"></script>
<script async src="//dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js">
</script>

<script>
    (function($) {
        $(document).ready(function() {
            // éšè—ç¦ç”¨javascriptï¼ˆé’ˆå¯¹å¾®ä¿¡å†…ç½®æµè§ˆå™¨ï¼‰çš„æç¤º
            $('.noscript').hide();

            // å›¾ç‰‡ç¼©æ”¾æ•ˆæœ
            var $imgs = $('img').not('.slider-image').not('.avatar-image').not('.carousel-image').not('.card-cover-image').not('.qrcode');

            // ç»™å›¾ç‰‡åŠ ä¸Šç‚¹å‡»æ”¾å¤§æ•ˆæœï¼ˆmaterialboxæ’ä»¶ï¼‰
            $imgs.addClass('materialboxed').each(function(i, el) {
                $(this).attr('data-caption', $(this).attr('alt') || ' ');
            }).materialbox();

            // ä¼˜åŒ–è¡¨æ ¼çš„æ˜¾ç¤º
            $('table').each(function() {
                var $table = $(this);
                // é™¤å»å¤šè¡Œä»£ç çš„æƒ…å†µ
                if ($table.find('pre').length == 0) {
                    $table.addClass('responsive-table striped bordered');
                }
            });

            // é¦–é¡µå¹»ç¯ç‰‡
            $('.slider').slider({indicators: true, full_width: true, interval: 8000});

            $(".button-collapse").sideNav();
            $(".category-menu").sideNav();

            // é’ˆå¯¹gallery post
            $('.carousel').carousel({full_width: true});
            $('.carousel-control.prev').click(function() {
                $('.carousel').carousel('prev');
            });
            $('.carousel-control.next').click(function() {
                $('.carousel').carousel('next');
            });

            // æ–‡ç« ç›®å½•
            $('article').not('.simple-article').find('h1').add('h2').add('h3').add('h4').add('h5').add('h6').scrollSpy();

            // ç›®å½•éšå±å¹•æ»šåŠ¨ï¼ˆé˜²æ­¢ç›®å½•è¿‡é•¿è¶Šè¿‡footerï¼‰
            var $toc = $('.toc');
            var scrollTargetTop = 0;
            $(window).scroll(function() {
                var $activeLink = $toc.find('a.active.section');
                if ($(window).scrollTop() < 100) {
                    scrollTargetTop = 0;
                } else {
                    if ($activeLink[0]) {
                        scrollTargetTop = $activeLink.offset().top - $toc.offset().top;
                    }
                }
                $toc.css('top', '-' + scrollTargetTop + 'px');
            });

            // ä¿®æ­£æ–‡ç« ç›®å½•çš„left-borderé¢œè‰²
            var color = $('.table-of-contents-text').css('color');
            $('.table-of-contents-link').css('border-left-color', color);

            // é’ˆå¯¹ç§»åŠ¨ç«¯åšçš„ä¼˜åŒ–ï¼šFABæŒ‰é’®ç‚¹å‡»ä¸€ä¸‹æ”¶å›
            if (/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent)) {
                $('.fixed-action-btn').addClass('click-to-toggle');
            }
            // å›åˆ°é¡¶éƒ¨
            $('.btn-return-top').click(function() {
                $('body, html').animate({
                    scrollTop: 0
                }, 500);
            });

            // é‡ç½®è¯»ä¹¦é¡µé¢çš„Tabæ ‡ç­¾é¡µçš„é¢œè‰²
            $('li.tab a').hover(function() {
                $(this).toggleClass('text-lighten-4');
            });
            $('.indicator').addClass('teal lighten-2');

            
            // æ·»åŠ newæ ‡ç­¾
            $('.menu-about').append('<span class="new badge teal accent-4"></span>');
            

            // æœç´¢åŠŸèƒ½
            $('.modal-trigger').leanModal({
                // æ‰“å¼€æœç´¢æ¡†æ—¶è‡ªåŠ¨èšç„¦
                ready: function() {
                    if ($('#search').is(":visible")) {
                        $('#search-input').focus();
                    }
                }
            });
            var searchXml = "search.xml";
            if (searchXml.length == 0) {
             	searchXml = "search.xml";
            }
            var searchPath = "/" + searchXml;
            initSearch(searchPath, 'search-input', 'search-result');
        });

        // åˆå§‹åŒ–æœç´¢ä¸åŒ¹é…å‡½æ•°
        var initSearch = function(path, search_id, content_id) {
            'use strict';
            $.ajax({
                url: path,
                dataType: "xml",
                success: function(xmlResponse) {
                    // get the contents from search data
                    var datas = $("entry", xmlResponse).map(function() {
                        return {
                            title: $("title", this).text(),
                            content: $("content", this).text(),
                            url: $("url", this).text()
                        };
                    }).get();
                    var $input = document.getElementById(search_id);
                    var $resultContent = document.getElementById(content_id);
                    $input.addEventListener('input', function() {
                        var str = '<ul class=\"search-result-list\">';
                        var keywords = this.value.trim().toLowerCase().split(/[\s\-]+/);
                        $resultContent.innerHTML = "";
                        if (this.value.trim().length <= 0) {
                            return;
                        }
                        // perform local searching
                        datas.forEach(function(data) {
                            var isMatch = true;
                            var content_index = [];
                            var data_title = data.title.trim().toLowerCase();
                            var data_content = data.content.trim().replace(/<[^>]+>/g, "").toLowerCase();
                            var data_url = data.url;
                            var index_title = -1;
                            var index_content = -1;
                            var first_occur = -1;
                            // only match artiles with not empty titles and contents
                            if (data_title != '' && data_content != '') {
                                keywords.forEach(function(keyword, i) {
                                    index_title = data_title.indexOf(keyword);
                                    index_content = data_content.indexOf(keyword);
                                    if (index_title < 0 && index_content < 0) {
                                        isMatch = false;
                                    } else {
                                        if (index_content < 0) {
                                            index_content = 0;
                                        }
                                        if (i == 0) {
                                            first_occur = index_content;
                                        }
                                    }
                                });
                            }
                            // show search results
                            if (isMatch) {
                                keywords.forEach(function(keyword) {
                                    var regS = new RegExp(keyword, "gi");
                                    data_title = data_title.replace(regS, "<span class=\"search-keyword teal lighten-2\">" + keyword + "</span>");
                                });

                                str += "<li><a href='" + data_url + "' class='search-result-title'>" + data_title + "</a>";
                                var content = data.content.trim().replace(/<[^>]+>/g, "");
                                if (first_occur >= 0) {
                                    // cut out 100 characters
                                    var start = first_occur - 20;
                                    var end = first_occur + 80;
                                    if (start < 0) {
                                        start = 0;
                                    }
                                    if (start == 0) {
                                        end = 100;
                                    }
                                    if (end > content.length) {
                                        end = content.length;
                                    }
                                    var match_content = content.substring(start, end);
                                    // highlight all keywords
                                    keywords.forEach(function(keyword) {
                                        var regS = new RegExp(keyword, "gi");
                                        match_content = match_content.replace(regS, "<span class=\"search-keyword teal lighten-2\">" + keyword + "</span>");
                                    });

                                    str += "<p class=\"search-result\">..." + match_content + "...</p>"
                                }
                                str += "</li>";
                            }
                        });
                        str += "</ul>";
                        $resultContent.innerHTML = str;
                    });
                }
            });
        }
    })(jQuery);
</script>


<script src="/js/prettify.js"></script>
<script type="text/javascript">
    $(document).ready(function() {
        $("pre").addClass("prettyprint");
        prettyPrint();
    });
</script>


<script>
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
        (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
            m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

    ga('create', 'UA-68058110-1', 'auto');
    ga('send', 'pageview');

</script>



<script type="text/javascript" src="http://tajs.qq.com/stats?sId=55079830" charset="UTF-8"></script>





</body>
</html>
